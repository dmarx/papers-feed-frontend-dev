# Understanding the Latent Space of Diffusion Models through the Lens of Riemannian Geometry

## Abstract

## 

Despite the success of diffusion models (DMs), we still lack a thorough understanding of their latent space. To understand the latent space x t ∈ X , we analyze them from a geometrical perspective. Our approach involves deriving the local latent basis within X by leveraging the pullback metric associated with their encoding feature maps. Remarkably, our discovered local latent basis enables image editing capabilities by moving x t , the latent space of DMs, along the basis vector at specific timesteps. We further analyze how the geometric structure of DMs evolves over diffusion timesteps and differs across different text conditions. This confirms the known phenomenon of coarse-to-fine generation, as well as reveals novel insights such as the discrepancy between x t across timesteps, the effect of dataset complexity, and the time-varying influence of text prompts. To the best of our knowledge, this paper is the first to present image editing through x-space traversal, editing only once at specific timestep t without any additional training, and providing thorough analyses of the latent structure of DMs. The code to reproduce our experiments can be found at [https://github.com/enkeejunior1/Diffusion-Pullback](https://github.com/enkeejunior1/Diffusion-Pullback).

## Introduction

The diffusion models (DMs) are powerful generative models that have demonstrated impressive performance [[22,](#b21)[51,](#b50)[52,](#b51)[17,](#b16)[37]](#b36). DMs have shown remarkable applications, including text-to-image synthesis [[45,](#b44)[46,](#b45)[5,](#b4)[36]](#b35), inverse problems [[14,](#b13)[31]](#b30), and image editing [[21,](#b20)[54,](#b53)[39,](#b38)[35]](#b34).

Despite their achievements, the research community lacks a comprehensive understanding of the latent space of DMs and its influence on the generated results. So far, the completely diffused images are considered as latent variables but it does not have useful properties for controlling the results. For example, traversing along a direction from a latent produces weird changes in the results. Fortunately, Kwon et al. [[26]](#b25) consider the intermediate feature space of the diffusion kernel, referred to as H, as a semantic latent space and show its usefulness on controlling generated images. In the similar sense, some works investigate the feature maps of the self-attention or cross-attention operations for controlling the results [[21,](#b20)[54,](#b53)[39]](#b38), improving sample quality [[8]](#b7), or downstream tasks such as semantic segmentation [[32,](#b31)[55]](#b54).

Still, the structure of the space X t where latent variables {x t } live remains unexplored despite its crucial role in understanding DMs. It is especially challenging because 1) the model is trained to estimate the forward noise which does not depend on the input, as opposed to other typical supervisions such as classification or similarity, and 2) there are lots of latent variables over multiple recursive timesteps. In this paper, we aim to analyze X in conjunction with its corresponding representation H, by incorporating a local geometry to X using the concept of a pullback metric in Riemannian geometry.

First, we discover the local latent basis for X and the corresponding local tangent basis for H. The local basis is obtained by performing singular value decomposition (SVD) of the Jacobian of the mapping from X to H. To validate the discovered local latent basis, we demonstrate that walking along the basis can edit real images in a semantically meaningful way. Furthermore, we can use the discovered local latent basis vector to edit other samples by using parallel transport, when they exhibit comparable local geometric structures. Note that existing editing methods manipulate the self-attention map or cross-attention map over multiple timesteps [[21,](#b20)[54,](#b53)[39]](#b38). On the other hand, we manipulate only x t once at a specific timestep.

Second, we investigate how the latent structures differ across different timesteps and samples as follows. The frequency domain of the local latent basis shifts from low-frequency to high-frequency along the generative process. We explicitly confirm it using power spectral density analysis. The difference between local tangent spaces of different samples becomes larger along the generative process. The local tangent spaces at various diffusion timesteps are similar to each other if the model is trained on aligned datasets such as CelebA-HQ or Flowers. However, this homogeneity does not occur on complex datasets such as ImageNet.

Finally, we examine how the prompts affect the latent structure of text-to-image DMs as follows.

Similar prompts yield similar latent structures. Specifically, we find a positive correlation between the similarity of prompts and the similarity of local tangent spaces. The influence of text on the local tangent space becomes weaker along the generative process.

Our work examines the geometry of X and H using Riemannian geometry. We discover the latent structure of X and how it evolves during the generative process and is influenced by prompts. This geometric exploration deepens our understanding of DMs.

## Related works

Diffusion Models. Recent advances in DMs make great progress in the field of image synthesis and show state-of-the-art performance [[50,](#b49)[22,](#b21)[51]](#b50). An important subject in the diffusion model is the introduction of gradient guidance, including classifier-free guidance, to control the generative process [[17,](#b16)[47,](#b46)[4,](#b3)[30,](#b29)[36,](#b35)[46]](#b45). The work by Song et al. [[52]](#b51) has facilitated the unification of DMs with score-based models using SDEs, enhancing our understanding of DMs as a reverse diffusion process. However, the latent space is still largely unexplored, and our understanding is limited.

The study of latent space in GANs. The study of latent spaces has gained significant attention in recent years. In the field of Generative Adversarial Networks (GANs), researchers have proposed various methods to manipulate the latent space to achieve the desired effect in the generated images [[44,](#b43)[41,](#b40)[1,](#b0)[20,](#b19)[49,](#b48)[59,](#b58)[38]](#b37). More recently, several studies [[60,](#b59)[10]](#b9) have examined the geometrical properties of latent space in GANs and utilized these findings for image manipulations. These studies bring the advantage of better understanding the characteristics of the latent space and facilitating the analysis and utilization of GANs. In contrast, the latent space of DMs remains poorly understood, making it difficult to fully utilize their capabilities.

Image manipulation in DMs. Early works include Choi et al. [[11]](#b10) and Meng et al. [[33]](#b32) have attempted to manipulate the resulting images of DMs by replacing latent variables, allowing the generation of desired random images. However, due to the lack of semantics in the latent variables of DMs, current approaches have critical problems with semantic image editing. Alternative approaches have explored the potential of using the feature space within the U-Net for semantic image manipulation. For example, Kwon et al. [[26]](#b25) have shown that the bottleneck of the U-Net, H, can be used as a semantic latent space. Specifically, they used CLIP [[43]](#b42) to identify directions within H that facilitate genuine image editing. Baranchuk et al. [[6]](#b5) and Tumanyan et al. [[54]](#b53) use the feature map of the U-Net for semantic segmentation and maintaining the structure of generated images. Unlike previous works, our editing method finds the editing direction without supervision, and directly traverses the latent variable along the latent basis.

Riemannain Geometry. Some studies have applied Riemannian geometry to analyze the latent spaces of deep generative models, such as Variational Autoencoders (VAEs) and GANs [[2,](#b1)[48,](#b47)[9,](#b8)[3,](#b2)[27,](#b26)[28,](#b27)[57]](#b56). Shao et al. [[48]](#b47) proposed a pullback metric on the latent space from image space Euclidean metric to analyze the latent space's geometry. This method has been widely used in VAEs and GANs because it only requires a differentiable map from latent space to image space. However, no studies have investigated the geometry of latent space of DMs utilizing the pullback metric.

## Discovering the latent basis of DMs

In this section, we explain how to extract a latent structure of X using differential geometry. First, we introduce a key concept in our method: the pullback metric. Next, by adopting the local Euclidean metric of H and utilizing the pullback metric, we discover the local latent basis of the X . Moreover, although the direction we found is local, we show how it can be applied to other samples via parallel transport. Finally, we introduce x-space guidance for editing data in the X to enhance the quality of image generation.

## Pullback metric

We consider a curved manifold, X , where our latent variables x t exist. The differential geometry represents X through patches of tangent spaces, T x , which are vector spaces defined at each point x. Then, all the geometrical properties of X can be obtained from the inner product of ||dx|| 2 = ⟨dx, dx⟩ x in T x . However, we do not have any knowledge of ⟨dx, dx⟩ x . It is definitely not a Euclidean metric. Furthermore, samples of x t at intermediate timesteps of DMs include inevitable noise, which prevents finding semantic directions in T x .

Fortunately, Kwon et al. [[26]](#b25) observed that H, defined by the bottleneck layer of the U-Net, exhibits local linear structure. This allows us to adopt the Euclidean metric on H. In differential geometry, when a metric is not available on a space, pullback metric is used. If a smooth map exists between the original metric-unavailable domain and a metric-available codomain, the pullback metric is used to measure the distances in the domain space. Our idea is to use the pullback Euclidean metric on H to define the distances between the samples in X .

DMs are trained to infer the noise ϵ t from a latent variable x t at each diffusion timestep t. Each x t has a different internal representation h t , the bottleneck representation of the U-Net, at different t's. The differentiable map between X and H is denoted as f : X → H. Hereafter, we refer to x t as x for brevity unless it causes confusion. It is important to note that our method can be applied at any timestep in the denoising process. We consider a linear map, T x → T h , between the domain and codomain tangent spaces. This linear map can be described by the Jacobian J x = ∇ x h which determines how a vector v ∈ T x is mapped into a vector u ∈ T h by u = J x v.

Using the local linearity of H, we assume the metric, ||dh|| 2 = ⟨dh, dh⟩ h = dh T dh as a usual dot product defined in the Euclidean space. To assign a geometric structure to X , we use the pullback  metric of the corresponding H. In other words, the norm of v ∈ T x is measured by the norm of corresponding codomain tangent vector:

$||v|| 2 pb ≜ ⟨u, u⟩ h = v T J x T J x v.(1)$
## Finding local latent basis

Using the pullback metric, we define the local latent vector v ∈ T x that shows a large variability in T h . We find a unit vector v 1 that maximizes ||v|| 2 pb . By maximizing ||v|| 2 pb while remaining orthogonal to v 1 , one can obtain the second unit vector v 2 . This process can be repeated to have

$n latent directions of {v 1 , v 2 , • • • , v n } in T x .$In practice, v i corresponds to the i-th right singular vector from the singular value decomposition (SVD) of J x = U ΛV T , i.e., J x v i = Λ i u i . Since the Jacobian of too many parameters is not tractable, we use a power method [[18,](#b17)[34,](#b33)[19]](#b18) to approximate the SVD of J x (See Appendix D for the time complexity and Appendix F for the detailed algorithm).

Henceforth, we refer to T x as a local latent subspace, and {v 1 , v 2 , • • • , v n } as the corresponding local latent basis.

$T x ≜ span{v 1 , v 2 • • • , v n }, where v i is i-th right singular vector of J x .(2)$Using the linear transformation between T x and T h via the Jacobian J x , one can also obtain corresponding directions in T h . In practice, u i corresponds to the i-th left singular vector from the SVD of J x . After selecting the top n (e.g., n = 50) directions of large eigenvalues, we can approximate any vector in T h with a finite basis, {u 1 , u 2 , • • • , u n }. When we refer to a local tangent space henceforth, it means the n-dimensional low-rank approximation of the original tangent space.

$T h ≜ span{u 1 , u 2 • • • , u n }, where u i is the i-th left singular vector of J x .(3)$The collection of local latent basis vectors, {v 1 , v 2 , • • • , v n }, obtained through our proposed method, can be interpreted as a signal that the model is highly response to for a given x. On the other hand, the basis of the local tangent space, denoted as {u 1 , u 2 • • • , u n }, can be viewed as the corresponding representation associated with the signal.

In Stable Diffusion, the prompt also influences the Jacobian, which means that the local basis also depends on it. We can utilize any prompt to obtain a local latent basis, and different prompts create distinct geometrical structures. For the sake of brevity, we will omit the word local unless it leads to confusion.

## Generating edited images with x-space guidance

A naïve approach for manipulating a latent variable x using a latent vector v is through simple addition, specifically x + γv. However, using the naïve approach sometime leads to noisy image generation. To address this issue, instead of directly using the basis for manipulation, we use a basis vector that has passed through the decoder once for manipulation. The x-space guidance is defined as follows

$xXG = x + γ[ϵ θ (x + v) -ϵ θ (x)](4)$where γ is a hyper-parameter controlling the strength of editing and ϵ θ is a diffusion model. Equation [4](#formula_4)is inspired by classifier-free guidance, but the key difference is that it is directly applied in the latent space X . Our x-space guidance provides qualitatively similar results to direct addition, while it shows better fidelity. (See Appendix C for ablation study.)

## The overall process of image editing

In this section, we summarize the entire editing process with five steps: 1) The input image is inverted into initial noise x T using DDIM inversion. 2) x T is gradually denoised until t through DDIM generation.

3) Identify local latent basis {v 1 , • • • , v n } using the pullback metric at t. 4) Manipulate

x t along the one of basis vectors using the x-space guidance. 5) The DDIM generation is then completed with the modified latent variable xt . Figure [2](#fig_2) illustrates the entire editing process.

In the context of a text-to-image model, such as Stable Diffusion, it becomes possible to include textual conditions while deriving local basis vectors. Although we do not use any text guidance during DDIM inversion and generation, a local basis with text conditions enables semantic editing that matches the given text. Comprehensive experiments can be found in Section 4.1.

It is noteworthy that our approach needs no extra training and simplifies image editing by only adjusting the latent variable within a single timestep.

## Editing various samples with parallel transport

Let us consider a scenario where our aim is to edit ten images, changing straight hair to curly hair. Due to the nature of the unsupervised image editing method, it is becomes imperative to manually check the semantic relevance of the latent basis vector in the edited results. Thus, to edit every samples, we have to manually find a straight-to-curly basis vector for individual samples.

One way to alleviate this tedious task is to apply the curly hair vector obtained from one image to other images. However, the basis vector v ∈ T x obtained at x cannot be used for the other sample x ′ because v / ∈ T x ′ . Thus, in order to apply the direction we obtained to another sample, it is necessary to relocate the extracted direction to a new tangent space. To achieve this, we use parallel transport that moves v i onto the new tangent space T x ′ .

Parallel transport moves a tangent vector u ∈ T h to u ′ ∈ T h ′ without changing its direction as much as possible while keeping the vector tangent on the manifold [[48]](#b47). It is notable that the parallel transport in curved manifold significantly modifies the original vector. Fortunately, H is relatively flat. Therefore, it is beneficial to apply the parallel transport in H. We aims to move v i onto new tangent space T x ′ , using parallel transport in H. First, we convert the latent direction v i ∈ T x to the corresponding direction of u i ∈ T h . Second, we apply the parallel transport

$u i ∈ T h to u ′ i ∈ T h ′ , where h ′ = f (x ′ ).$In the general case, parallel transport involves iterative projection and normalization on the tangent space along the path connecting two points [[48]](#b47). However, in our case, we assume that H has Euclidean geometry. Therefore, we move u directly onto T h ′ through projection, without the need for an iterative process. Finally, transform

$u ′ i into v ′ i ∈ X . Using this parallel transport of v i → v ′$i via H, we can apply the local latent basis obtained from x to edit or modify the input x ′ .

## Findings and results

In this section, we analyze the geometric structure of DMs with our method. § 4.1 demonstrates that the latent basis found by our method can be used for image editing. In § 4.2, we investigate how the geometric structure of DMs evolves as the generative process progresses. Lastly, in § 4.3, we examine how the geometric properties of the text-condition model change with a given text.

The implementation details of our work are provided on Appendix B. The source code for our experiments is included in the supplementary materials and will be publicly available upon publication. ). Notably, when given the "Lion" prompt, it is evident that all the top latent basis vectors align with the direction of the prompt.

## Image editing with the latent basis

In this subsection, we demonstrate the capability of our discovered latent basis for image editing.

To extract the latent variables from real images for editing purposes, we use DDIM inversion. In experiments with Stable Diffusion (SD), we do not use guidance, i.e., unconditional sampling, for both DDIM inversion and DDIM sampling processes. This ensures that our editing results solely depend on the latent variable, not on other factors such as prompt conditions. Each column is edited using the latent basis vector obtained from a different text prompt. Importantly, our method employs each prompt only once to derive the local latent basis.

Figures [2](#fig_2) and [3](#) illustrate the example results edited by the latent basis found by our method. The latent basis clearly contains semantics such as age, gender, species, structure, and texture. Note that editing at timestep T yields coarse changes such as age and species. On the other hand, editing at timestep 0.6T leads to fine changes, such as nose color and facial expression. Figure [4](#) demonstrates the example results edited by the various latent basis vectors. Interestingly, using the text "lion" as a condition, the entire latent basis captures lion-related attributes. Furthermore, Figure [5](#fig_4) shows that the latent basis aligns with the text not only in terms of object types but also in relation to pose or action. For a qualitative comparison with other state-of-the-art image editing methods, refer to Appendix D. For more examples of editing results, refer to Appendix G. In this subsection, we demonstrate how the latent structure evolves during the generative process and identify three trends. 1) The frequency domain of the latent basis changes from low to high frequency. It agrees with the previous observation that DMs generate samples in coarse-to-fine manner.

## Evolution of latent structures during generative processes

2) The difference between the tangent spaces of different samples increases over the generative process. It implies finding generally applicable editing direction in latent space becomes harder in later timesteps.

3) The differences of tangent spaces between timesteps depend on the complexity of the dataset.

Latent bases gradually evolve from low-to highfrequency structures. Figure [6](#fig_5) is the power spectral density (PSD) of the discovered latent basis over various timesteps. The early timesteps contain a larger portion of low frequency than the later timesteps and the later timesteps contain a larger portion of high frequency.

This suggests that the model focuses on low-frequency signals at the beginning of the generative process and then shifts its focus to high-frequency signals over time. This result strengthens the common understanding about the coarse-to-fine behavior of DMs over the generative process [[12,](#b11)[15]](#b14).

The discrepancy of tangent spaces from different samples increases along the generative process.

To investigate the geometry of the tangent basis, we employ a metric on the Grassmannian manifold.

The Grassmannian manifold is a manifold where each point is a vector space, and the metric defined above represents the distortion across various vector spaces. We use geodesic metric [[10,](#b9)[56]](#b55) to define the discrepancy between two subspaces {T (1) , T (2) }: where θ k denotes the k-th principle angle between T (1)  and T (2) . Intuitively, the concept of geodesic metric can be understood as an angle between two vector spaces.

$D geo (T (1) , T (2) ) = k θ 2 k ,(5)$Here, the comparison between two different spaces was conducted for {T h1 , T h2 }. Unlike the X , the H assumes a Euclidean space which makes the computation of geodesic metric that requires an inner product between tangent spaces easier. The relationship between tangent space and latent subspace is covered in more detail in Appendix E.

Figure [7](#fig_6) demonstrates that the tangent spaces of the different samples are the most similar at t = T and diverge as timestep becomes zero.

Moreover, the similarity across tangent spaces allows us to effectively transfer the latent basis from one sample to another through parallel transport as shown in Figure [8](#). In T , where the tangent spaces are homogeneous, we consistently obtain semantically aligned editing results. On the other hand, parallel transport at t = 0.6T does not lead to satisfactory editing because the tangent spaces are hardly homogeneous. Thus, we should examine the similarity of local subspaces to ensure consistent editing across samples.

DMs trained on simpler datasets exhibit more consistent tangent spaces over time. In Figure [9](#) (a), we provide a distance matrix of the tangent spaces across different timesteps, measured by the geodesic metric. We observe that the tangent spaces are more similar to each other when a model is trained on CelebA-HQ, compared to ImageNet. To verify this trend, we measure the geodesic distances between tangent spaces of different timesteps and plot the average distances of the same difference in timestep in Figure [9](#) (b). As expected, we find that DMs trained on datasets, that are generally considered simpler, have similar local tangent spaces over time.

## Effect of conditioning prompts on the latent structure

In this subsection, we aim to investigate how prompts influence the generative process from a geometrical perspective. We randomly sampled 50 captions from the MS-COCO dataset [[29]](#b28) and used them as text conditions.

Similar text conditions induce similar tangent spaces. In Figure [10](#fig_8) (a), we observe a negative correlation between the CLIP similarity of texts and the distance between tangent spaces. In other words, when provided with similar texts, the tangent spaces are more similar. The linear relationship between the text and the discrepancy of the tangent spaces is particularly strong in the early phase of the generative process as shown by R 2 score in Figure [10 (b)](#fig_8).

The generative process depends less on text conditions in later timesteps.  

## Discussion

In this section, we provide additional intuitions and implications. It is interesting that our latent basis usually conveys disentangled attributes even though we do not adopt attribute annotation to enforce disentanglement. We suppose that decomposing the Jacobian of the encoder in the U-Nets naturally yields disentanglement to some extent. However, it does not guarantee the perfect disentanglement and some directions are entangled. For example, the editing for beard converts a female subject to a male as shown in Figure [11](#fig_9) (a). This kind of entanglement often occurs in other editing methods due to the dataset bias: female faces seldom have beard.

While our method has shown effectiveness in Stable Diffusion, more research is needed to fully validate its potential. We have observed that some of the discovered latent vector occasionally leads to abrupt changes during the editing process in Stable Diffusion, as depicted in Figure [11 (b](#fig_9)). This observation highlights the complex geometry of X in achieving seamless editing. Exploring this topic in future research is an interesting area to delve into.

Our approach is broadly applicable when the feature space in the DM adheres to a Euclidean metric, as demonstrated by H. This characteristic has been observed in the context of U-Net within Kwon et al. [[26]](#b25). It would be intriguing to investigate if other architectural designs, especially those similar to transformer structures as introduced in [[42,](#b41)[53]](#b52), also exhibit a Euclidean metric.

Despite these limitations, our method provides a significant advance in the field of image editing for DMs, and provides a deep understanding of DM through several experiments.

## Conclusion

We have analyzed the latent space of DMs from a geometrical perspective. We used the pullback metric to identify the latent and tangent bases in X and H. The latent basis found by the pullback metric allows editing images by traversal along the basis. We have observed properties of the bases in two aspects. First, we discovered that 1) the latent bases evolve from low-to high-frequency components;

2) the discrepancy of tangent spaces from different samples increases along the generative process; and 3) DMs trained on simpler datasets exhibit more consistent tangent spaces over timesteps. Second, we investigated how the latent structure changes based on the text conditions in Stable Diffusion, and discovered that similar prompts make tangent space analogous but its effect becomes weaker over timesteps. We believe that a better understanding of the geometry of DMs will open up new possibilities for adopting DMs in useful applications.

Table A1: Hyper-parameter settings. model t edit inversion step γ n t boost Stable Diffusion 0.7T 100 1 50 × 0.6T 100 2 50 × Unconditional DMs T 100 0.5 50 0.2T 0.8T 100 1 50 0.2T 0.6T 100 4 50 0.2T

## A Societal Impacts & Ethics Statements

Our research endeavors to unravel the geometric structures of the diffusion model and facilitate high-quality image editing within its framework. While our primary application resides within the creative realm, it is important to acknowledge that image manipulation techniques, such as the one proposed in our method, hold the potential for misuse, including the dissemination of misinformation or potential privacy implications. Therefore, the continuous advancement of technologies aimed at thwarting or identifying manipulations rooted in generative models remains of utmost significance.

## B Implementation details

Models and datasets We validate our method and provide analyses on various models using the official code and pre-trained checkpoints. The available combinations of the models and the datasets are: DDPM [[22]](#b21) on ImageNet [[16]](#b15), LSUN-church/bedroom/cat/horse [[58]](#b57), and CelebA-HQ [[23]](#b22); and DDPM trained with P2 weighting [[12]](#b11) on FFHQ [[24]](#b23), Flowers [[58]](#b57) and AFHQ [[13]](#b12). We also use Stable Diffusion (SD) version 2.1 [[46]](#b45) for the text-conditional diffusion model.

For image editing, we use the official codes and pre-trained checkpoints for all baselines and keep the parameters frozen. For analysis, we compare models with the same diffusion scheduling (linear schedule) and resolutions (256 2 ) to ensure a fair comparison, except Stable Diffusion.

Table [B1](#) summarizes various hyperparameter settings in our experiments. Specific details not covered in the main text are discussed in the following paragraphs.

Edit timestep (t edit ) For unconditional DMs, we show the editing results at t edit ∈ {T, 0.8T, 0.6T }, while for Stable Diffusion, we show the editing results at t edit ∈ {0.7T, 0.6T }. Note that our method allows manipulation at any timestep.

## Inversion step

We conduct real image editing with DDIM inversion [[51]](#b50). We set the number of steps to 100 for obtaining the latent variable x T and all experiments.

x-space guidance scale (γ) The value of γ determines the magnitude of a single editing step by x-space guidance. Fortunately, through experimentation, we observed that the value of γ does not have a significant impact on image quality unless it is excessively large.

## Low-rank approximation (n)

We employ a low-rank approximation of the tangent space using n = 50 for all settings.

Quality boosting (t boost ) While DDIM alone already generates high-quality images, Karras et al. [[25]](#b24) showed that including stochasticity in the process improves image quality and Kwon et al. [[26]](#b25) suggest similar technique: adding stochasticity at the end of the generative process. We employ this technique in our experiments on every experiment after t = 0.2T , except Stable Diffusion.

Computing resource For power-method approximation with n = 50, it spends about 3-4 minutes on a single NVIDIA RTX 3090 (24GB). As n specifies the number of bases, it can be as small as a user want to use for image editing. Reducing n provides faster runtime, e.g., 10 seconds for n = 3. 

## C Ablation study

In this section, we validate our method with ablation study.

## Random v

To demonstrate the meaningfulness of the latent basis found by our method, we qualitatively compare its effect to naïve baseline: random directions. The first row in Figure [A1](#fig_10) shows that manipulating the images with a random vector 'v' does not result in semantic editing but rather degrades images. The second row shows the results of projecting the random 'v' onto our obtained latent subspace. The projected results exhibit semantic manipulation such as pose changes without image distortion. It indicates that the found latent subspace captures semantics in the latent space effectively.

x-space guidance Figure [A2](#fig_2) demonstrates the the effectiveness of x-space guidance compared to a straightforward alternative: simple addition. First, x-space guidance produces higher quality images with similar meaning. Especially Stable Diffusion apparently benefits from x-space guidance regarding smoothness of the editing strength and artifacts. The difference is more significant at t = 0.6T . Note that the meaning of the same directions may slightly differ between the two settings due to non-linearity of the U-Net.

Currently, we do not have a deeper understanding of the underlying principles of x-space guidance.

Exploring the reasons behind its ability to improve manipulation quality would be an interesting direction for future work.

## D Comparative experiment to other state-of-the-art (SoTA) editing methods

We conduct qualitative comparisons with text-guided image editing methods. Our SoTA baseline methods include: (i) SDEdit [[33]](#b32), (ii) Pix2Pix-zero [[39]](#b38), (iii) PnP [[54]](#b53), and (iv) Instruct Pix2Pix [[7]](#b6). All comparisons were performed using the official code. Please refer to Figure [A3](#) for the qualitative results.

We also compare the time complexity of each method. For a fair comparison, we only identify the first singular vector v 1 , i.e., n = 1, and set the number of DDIM steps to 50. All experiments were conducted on an Nvidia RTX 3090. The runtime for each method is summarized in Table [A2](#). The computation cost of our method remains comparable to other approaches, although the Jacobian approximation takes around 2.5 seconds for n = 1. This is because we only need to identify the latent basis vector once at a specific timestep. Furthermore, our approach does not require additional preprocessing steps like generating 100 prompts with GPT and obtaining embedding vectors (as in Pix2Pix-zero), or storing feature vectors, queries, and key values (as in PnP). Our method also does not require finetuning (as in Instruct Pix2Pix). This leads to a significantly reduced total editing process time in comparison to other methods.

Table A2: Comparisons of the time complexity of state-of-the-art editing methods Image Edit Method Running time Preprocessing Ours 11 sec N/A SDEdit 4 sec N/A Pix2Pix-zero 25 sec 4 min PnP 10 sec 40 sec Instruct Pix2Pix 11 sec N/A  

## E More Discussions

Why do we measure the geodesic distance of the tangent spaces instead of the latent subspaces?

The geodesic distance on the Grassmannian manifold between two subspaces is defined as the l 2 -norm of principal angles. To define angles between different vector spaces, an inner product needs to be defined. In our work, we define the inner product in T x using the pullback metric. The issue is that the pullback metric is locally defined for each latent subspace T x (Eq. ( [1](#formula_0))). Therefore, measuring angles between distant latent subspaces becomes challenging. On the other hand, H follows the assumption of the Euclidean metric. Consequently, even for distant tangent spaces, angles can be easily computed using the dot product. In this regard, we measure the similarity between latent subspaces by exploiting the geodesic distance of their corresponding tangent spaces. Furthermore, when compared to X , H offers the advantage of being a semantic space, making it more suitable for measuring semantic similarity.

Similar tangent space implies similar latent subspace In Figure [A4](#fig_13), we calculated the geodesic distance of tangent spaces obtained at different timesteps (or different samples at same the timestep) and the angle between the original latent direction and parallel transported direction between them. It is evident that as the geodesic distance decreases, the amount of distortion during parallel transport also reduces.

Notice that the similarity between tangent spaces implies consistency of latent basis across timesteps.

In Figure [A5](#fig_4) (b), we parallel transport the latent vector v i to various tangent spaces and visualize the outcomes. As expected, when the tangent spaces are similar, the transported vector v ′ i retains the original signal. On the other hand, as we move to more distant timesteps, where the tangent space is farther apart, v ′ i deviates from the original signal. denotes the latent vector transported from t a to t b . Transported vector significantly deviates from the original vector, as the tangent space grows further apart according to the distance matrix. For visualization purposes, v i is min-max normalized.

## F Algorithms

In this section, for reproducibility purposes, we provide the code for two important algorithms. The code is implemented using PyTorch [[40]](#b39).

## Jacobian subspace iteration

The diffusion model has dimensions that are too large in both X and H, making the computation of the Jacobian infeasible. To overcome this challenge, we attempt the Jacobian subspace iteration algorithm to approximate the singular value of the Jacobian, as proposed in [[19]](#b18). For details, please refer to Haas et al. [[19]](#b18).  latent basis with given prompt As shown in Figure [A11](#fig_10), when we condition a specific prompt, such as "Zebra" or "Chimpanzee", the entire latent basis corresponds to the prompt-related attributes. Notably, Changes to "zebra", which are clear, all show similar results, but "chimpanzee" show different results. Nevertheless, it is clear that they are all related to "chimpanzee".

Real image w/ "Zebra" Real image w/ "Chimpanzee"

Figure [A11](#fig_10): More examples of image editing using top-5 latent basis vectors when given the prompt. Notably, Changes to "zebras", which are clear, all show similar results, but "chimpanzees" show different results. Nevertheless, it is clear that it is all related to "chimpanzees".

## G.2 Image editing using latent basis vectors discovered with various prompts

We provide additional examples of image editing using latent basis vectors discovered with various prompts. Figure [A12](#fig_10), A13 show image editing with various pictures and various prompts. For brevity, we denote the prompt "a cat dressed as a witch wearing a wizard hat in a haunted house" by "[ • • • cat • • ]" in Figure [A12](#fig_10).  In this subsection, we provide a discussion based on the failure cases of our approach. Figure [A14](#fig_10) shows the results of latent basis found at t = T with Stable diffusion. Unlike unconditional models, the directions found at t = T exhibit rapid and drastic unexpected changes. However, landscape photos, which do not contain a main object, exhibited desired editing effects at any timesteps. Moreover, in the case of landscapes, it is conjectured that the latent basis plays a significant role in representing patterns and textures. Analyzing the landscape images generated by Stable diffusion would be an interesting topic.

Figure [A15](#fig_10) presents examples of failure cases in our image editing using latent basis vectors discovered with various prompts. (a) When using pose or action as a prompt, there are instances where the identity is not preserved. (b) When the shape of the target subject differs significantly from the source image, the results are often unsatisfactory. (c) There are cases where the preservation of the background is not achieved. (d) It is challenging to make significant changes to the entire image.

Regarding the reasons for these failure cases, we emphasize two factors. First, we manipulate in the X . The result in Figure [A15](#fig_10) (a) implies that X is not a space where disentanglement for identity is achieved effectively. On the other hand, in H, there are results indicating successful preservation of identity [[26,](#b25)[19]](#b18). Investigating the disentanglement capability of X and any other distinguishing features it may have compared to H would be an interesting future research topic.

Secondly, we perform manipulation by adding and subtracting the "signal" that the model pays attention to in x t . Here, The signal is captured from the current input x t , which limits the deviation from the original form. Therefore, when there is a substantial difference in shape, such as transforming a giraffe into a tiger, the results may not be satisfactory. Despite these limitations, we have successfully achieved direct manipulation in the latent space x t at a single timestep, which, to our knowledge, is the first of its kind. Through this, we provide insights into the model and contribute to the understanding of the latent space, hopefully benefiting the diffusion community. 

![Figure 1: Conceptual illustration of local geometric structure. (a) The local basis {v 1 , v 2 , • • • } of the local latent subspace T xt within the latent space X is interlinked with the local basis {u 1 , u 2 , • • • } of the local tangent space T ht in the feature space H. (b) The derivation of these local bases is facilitated through the singular value decomposition (SVD) of the Jacobian, which emanates from the U-Net responsible for encoding the feature map f , linking X and H.]()

![Figure 2: Image editing with the discovered latent basis. (a) Schematic depiction of our image editing procedure. ① An input image is subjected to DDIM inversion, resulting in an initial noisy sample x T . ② The sample x T is progressively denoised until reaching the point t through DDIM generation. ③ Subsequently, the local latent basis {v 1 , • • • , v n } is identified by using the pullback metric. ④ This enables the manipulation of the sample x t along one of the basis vectors using x-space guidance. ⑤ The DDIM generation concludes with the progression from the modified latent variable xt . (b) Examples of edited images using a selected basis vector. The latent basis vector could be conditioned on prompts and it facilitates text-aligned manipulations.]()

![Figure 3: Examples of image edition using the latent basis. The attributes are manually interpreted since the editing directions are not intentionally supervised. For Stable Diffusion, we used an empty string as a prompt. Each column represents edits made at different diffusion timesteps (0.6T , 0.8T , and T for the unconditional diffusion model; 0.6T and 0.7T for Stable Diffusion).]()

![Figure 5: Examples of image edition using latent basis vectors discovered with various prompts.Each column is edited using the latent basis vector obtained from a different text prompt. Importantly, our method employs each prompt only once to derive the local latent basis.]()

![Figure 6: Power Spectral Density (PSD) of latent basis. The PSD at t = T (purple) exhibits a greater proportion of lowfrequency signals, while the PSD at smaller t (beige) reveals a larger proportion of highfrequency signals. The latent vectors v i are min-max normalized for visual clarity.]()

![Figure 7: Geodesic distance across tangent space of different samples at various diffusion timesteps. Each point represents the average geodesic distance between pairs of 15 samples. It is notable that the similarity of tangent spaces among different samples diminishes as the generative process progresses.]()

![Figure 8: Examples of image edition using parallel transport. The first row demonstrates the results of editing with their respective latent vectors, while the subsequent rows exhibit the results of editing through the parallel transport (P.T) of the latent vectors used in the first row. The latent vector performs effectively when t = T (left and middle), but comparatively less satisfactorily for 0.6T (right).]()

![(c) illustrates the distances between local tangent spaces for given different prompts with respect to the timesteps.]()

![Figure 11: Limitations. (a) Entanglement between attributes due to dataset biases (b) Abrupt changes in Stable Diffusion.Notably, as the diffusion timestep approaches values below 0.7T , the distances between the local tangent spaces start to decrease. It implies that the variation due to walking along the local tangent basis depends less on the text conditions, i.e., the text less influences the generative process, in later timesteps. It is a possible reason why the correlation between the similarity of prompts and the similarity of tangent spaces reduces over timesteps.]()

![Figure A1: Importance the discovered latent directions. Random direction experiments with CelebA-HQ pre-trained model (top) and Stable Diffusion (bottom). Adding random directions instead of latent directions severely distorts the resulting images. When we perform edits along the projection onto the latent subspace T x , the generated image presents a semantically meaningful transformation.]()

![Figure A2: Importance of the x-space guidance. x-space guidance experiments with AFHQ (top), Flowers pre-trained model (middle), and Stable Diffusion (bottom). x-space guidance helps achieve qualitatively similar editing while preserving the content of the original image.]()

![(a) Parallel transport across timesteps (b) Parallel transport across samples]()

![Figure A4: Parallel transport between similar tangent spaces creates similar latent directions. The horizontal axis represents the geodesic distance between tangent spaces from (a) different timesteps (b) different samples at t ∈ {T, 0.9T, • • • , 0.1T }. The vertical axis represents the angle between the original latent direction and transported latent direction. Different colors represent various datasets. A positive relationship is observed between tangent space distance and the distortion induced by parallel transport.]()

![Figure A5: More examples of tangent spaces across diffusion timesteps. (a) Distance matrix visualization of tangent space measured by geodesic metric across various timesteps. (b) Visualization of the result from parallel transport across timesteps. v ′ ta→t b i]()

![import torch # >= ver 2.0 def l oc al_ enc od er_ pu llb ac k ( 4 x , t , get_h , n =50 , chunk_size =25 , min_iter =10 , max_iter =100 , con vergen ce_thr eshol d =1 e -4 , x : tensor ; latent variable 9 -t : tensor ; diffusion timestep 10 -get_h : function ; return h given x , t 11 -n ; low -rank approximation dimension 12 -chunk_size ; To avoid OOM error 13 -min_iter ( max_iter ) ; minimum ( maximum ) number of iteration 14 -con verge nce_th reshol d ; to check convergence of power -method set number of chunk to avoid OOM 17 num_chunk = n // chunk_size + 1 18 get dimensions of x space and h space 20 h_shape = get_h (x , t ) . shape 21 c_i , w_i , h_i = x . size (1) , x . size (2) , x . size (3)22c_o , w_o , h_o = h_shape[1] , h_shape[2] , h_shape[3]]()

![Figure A8: More examples of image editing using the latent basis in Flowers. The editing result using ten v i ' in Flowers. Each column represents edits made at different diffusion timesteps (0.6T , 0.8T , and 1T ). Editing at timestep 1T yields coarse changes. On the other hand, editing at timestep 0.6T leads to fine changes. Please zoom in for the best view.]()

![• cat• • • ] → [• • • girl• • • ] • cat• • • ] → [• • • dog• • • ]]()

![Figure A12: More examples of image editing using latent basis vectors discovered with various prompts.]()

![(FigureA15 (b)) When we utilize text conditions, the latent basis aligns with the text information. This leads to not capturing background information, resulting in changes in the background when manipulated. It is also an interesting research topic to capture signals related to the background. (FigureA15 (c)) Since the model focuses on finer features as t approaches 0, if broad changes are desired, manipulation should be performed at t = T . However, manipulation at t = T is unstable. Deep analysis of x t at t = T in Stable diffusion is also an intriguing research topic. (FigureA15 (d))]()

![Figure A14: Failure cases of image editing using the latent basis at 1T . The editing result using v i ' in Stable diffusion at 1T .]()

for i in range ( max_iter ) :

