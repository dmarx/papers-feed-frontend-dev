# Neural Embeddings of Graphs in Hyperbolic Space

## Abstract

## 

Neural embeddings have been used with great success in Natural Language Processing (NLP). They provide compact representations that encapsulate word similarity and attain state-of-the-art performance in a range of linguistic tasks. The success of neural embeddings has prompted signi cant amounts of research into applications in domains other than language. One such domain is graph-structured data, where embeddings of vertices can be learned that encapsulate vertex similarity and improve performance on tasks including edge prediction and vertex labelling. For both NLP and graph based tasks, embeddings have been learned in highdimensional Euclidean spaces. However, recent work has shown that the appropriate isometric space for embedding complex networks is not the at Euclidean space, but negatively curved, hyperbolic space. We present a new concept that exploits these recent insights and propose learning neural embeddings of graphs in hyperbolic space. We provide experimental evidence that embedding graphs in their natural geometry signi cantly improves performance on downstream tasks for several real-world public datasets.

## INTRODUCTION

Embedding (or vector space) methods nd a lower-dimensional continuous space in which to represent high-dimensional complex data [[4,](#b3)[26]](#b25). The distance between objects in the lower-dimensional space gives a measure of their similarity. This is usually achieved by rst postulating a low-dimensional vector space and then optimising an objective function of the vectors in that space. Vector space representations provide three principle bene ts over sparse schemes: (1) They encapsulate similarity, (2) they are compact, (3) they perform better as inputs to machine learning models [[27]](#b26). This is true of graph structured data where the native data format is the adjacency matrix, a typically large, sparse matrix of connection weights.

Neural embedding models are a avour of embedding scheme where the vector space corresponds to a subset of the network weights, which are learned through backpropagation. Neural embedding models have been shown to improve performance in a large number of downstream tasks across multiple domains. These include word analogies [[18,](#b17)[20]](#b19), machine translation [[28]](#b27), document comparison [[16]](#b15), missing edge prediction [[12]](#b11), vertex attribution [[24]](#b23), product recommendations [[2,](#b1)[10]](#b9), customer value prediction [[6,](#b5)[14]](#b13) and item categorisation [[3]](#b2). In all cases the embeddings are learned without labels (unsupervised) from a sequence of entities.

To the best of our knowledge, all previous work on neural embedding models either explicitly or implicitly (by using the Euclidean dot product) assumes that the vector space is Euclidean. Recent work from the eld of complex networks has found that many interesting networks, such as the Internet [[5]](#b4) or academic citations [[7,](#b6)[8]](#b7) can be well described by a framework with an underlying non-Euclidean hyperbolic geometry. Hyperbolic geometry provides a continuous analogue of tree-like graphs, and even in nite trees have nearly isometric embeddings in hyperbolic space [[11]](#b10). Additionally, the de ning features of complex networks, such as power-law degree distributions, strong clustering and hierarchical community structure, emerge naturally when random graphs are embedded in hyperbolic space [[15]](#b14).

The starting point for our model is the celebrated word2vec Skipgram architecture, which is shown in Figure [3](#fig_3)[[18,](#b17)[19]](#b18). Skipgram is a shallow neural network with three layers: (1) An input projection layer that maps from a one-hot-encoded to a distributed representation, (2) a hidden layer, and (3) an output softmax layer. The network is necessarily simple for tractability as there are a very large number of output states (every word in a language). Skipgram is trained on a sequence of words that is decomposed into (input word, context word)-pairs. The model employs two separate vector representations, one for the input words and another for the context words, with the input representation comprising the learned embedding. The word pairs are generated by taking a sequence of words and running a sliding window (the context) over them. As an example the word sequence "chance favours the prepared mind" with a context window of size three would generate the following training data: (chance, favours), (chance, the), (favours, chance), ... }. Words are initially randomly allocated to vectors within the two vector spaces. Then, for each training pair, the vector representations of the observed input and context words are pushed towards each other and away from all other words (see Figure [2](#fig_2)).

The concept can be extended from words to network structured data using random walks to create sequences of vertices. The vertices are then treated exactly analogously to words in the NLP formulation. This was originally proposed as DeepWalk [[24]](#b23). Extensions varying the nature of the random walks have been explored in LINE [[29]](#b28) and Node2vec [[12]](#b11).

Contribution. In this paper, we introduce the new concept of neural embeddings in hyperbolic space. We formulate backpropagation in hyperbolic space and show that using the natural geometry of complex networks improves performance in vertex classi cation tasks across multiple networks.

## HYPERBOLIC GEOMETRY

Hyperbolic geometry emerges from relaxing Euclid's fth postulate (the parallel postulate) of geometry. In hyperbolic space there is not arXiv:1705.10359v1 [stat.ML] 29 May 2017  just one, but an in nite number of parallel lines that pass through a single point. This is illustrated in Figure [1b](#fig_1) where every line is parallel to the bold, blue line and all pass through the same point. Hyperbolic space is one of only three types of isotropic spaces that can be de ned entirely by their curvature. The most familiar is Euclidean, which is at, having zero curvature. Space with uniform positive curvature has an elliptic geometry (e.g. the surface of a sphere), and space with uniform negative curvature is called hyperbolic, which is analogous to a saddle-like surface. As, unlike Euclidean space, in hyperbolic space even in nite trees have nearly isometric embeddings, it has been successfully used to model complex networks with hierarchical structure, power-law degree distributions and high clustering [[15]](#b14).

One of the de ning characteristics of hyperbolic space is that it is in some sense larger than the more familiar Euclidean space; the area of a circle or volume of a sphere grows exponentially with its radius, rather than polynomially. This suggests that low-dimensional hyperbolic spaces may provide e ective representations of data in ways that low-dimensional Euclidean spaces cannot. However this makes hyperbolic space hard to visualise as even the 2D hyperbolic plane can not be isometrically embedded into Euclidean space of any dimension,(unlike elliptic geometry where a 2-sphere can be embedded into 3D Euclidean space). For this reason there are many di erent ways of representing hyperbolic space, with each representation conserving some geometric properties, but distorting others. In the remainder of the paper we use the Poincaré disk model of hyperbolic space.

## Poincaré Disk Model

The Poincaré disk models two-dimensional hyperbolic space where the in nite plane is represented as a unit disk. We work with the two-dimensional disk, but it is easily generalised to the ddimensional Poincaré ball, where hyperbolic space is represented as a unit d-ball.

In this model hyperbolic distances grow exponentially towards the edge of the disk. The circle's boundary represents in nitely distant points as the in nite hyperbolic plane is squashed inside the nite disk. This property is illustrated in Figure [1a](#fig_1) where each tile is of constant area in hyperbolic space, but the tiles rapidly shrink to zero area in Euclidean space. Although volumes and distances are warped, the Poincaré disk model is conformal, meaning that Euclidean and hyperbolic angles between lines are equal. Straight lines in hyperbolic space intersect the boundary of the disk orthogonally and appear either as diameters of the disk, or arcs of a circle. Figure [1b](#fig_1) shows a collection of straight hyperbolic lines in the Poincaré disk. Just as in spherical geometry, the shortest path from one place to another is a straight line, but appears as a curve on a at map. Similarly, these straight lines show the shortest path (in terms of distance in the underlying hyperbolic space) from one point on the disk to another, but they appear curved. This is because it is quicker to move close to the centre of the disk, where distances are shorter, than nearer the edge. In our proposed approach, we will exploit both the conformal property and the circular symmetry of the Poincaré disk.

Overall, the geometric intuition motivating our approach is that vertices embedded near the middle of the disk can have more close neighbours than they could in Euclidean space, whilst vertices nearer the edge of the disk can still be very far from each other.

## Inner Product, Angles, and Distances

The mathematics is considerably simpli ed if we exploit the symmetries of the model and describe points in the Poincaré disk using polar coordinates, x = (r e , θ ), with r e ∈ [0, 1) and θ ∈ [0, 2π ). To de ne similarities and distances, we require an inner product. In the Poincaré disk, the inner product of two vectors x = (r x , θ x ) and = (r , θ ) is given by

$x, = x cos(θ x -θ ) (1) = 4 arctanh r x arctanh r cos(θ x -θ )(2)$The distance of x = (r e , θ ) from the origin of the hyperbolic coordinate system is given by r h = 2 arctanh r e and the circumference of a circle of hyperbolic radius R is C = 2π sinh R.

## NEURAL EMBEDDING IN HYPERBOLIC SPACE

We adopt the original notation of [[18]](#b17) whereby the input vertex is w I and the output is w O . Their corresponding vector representations are w I and w O , which are elements of the two vector spaces shown in Figure [3](#fig_3), W and W respectively. Skipgram has a geometric interpretation, which we visualise in Figure [2](#fig_2) for vectors in W . Updates to w j are performed by simply adding (if w j is the observed output vertex) or subtracting (otherwise) an errorweighted portion of the input vector. Similar, though slightly more complicated, update rules apply to the vectors in W. Given this interpretation, it is natural to look for alternative geometries in which to perform these updates.

To embed a graph in hyperbolic space we replace Skipgram's two Euclidean vector spaces (W and W in Figure [3](#fig_3)) with two Poincaré disks. We learn embeddings by optimising an objective function that predicts output/context vertices from an input vertex, but we replace the Euclidean dot products used in Skipgram with hyperbolic inner products. A softmax function is used for the conditional predictive distribution

$v (old) v (new) wO v (new)$$p(w O |w I ) = exp( w O , w I ) V i=1 exp( w i , w I ) ,(3)$where w i is the vector representation of the i t h vertex, primed indicates members of the output vector space (See Figure [3](#fig_3)) and •, • is the hyperbolic inner product. Directly optimising (3) is computationally demanding as the sum in the denominator extends over every vertex in the graph. Two commonly used techniques to make word2vec more e cient are (a) replacing the softmax with a hierarchical softmax [[18,](#b17)[21]](#b20) and (b) negative sampling [[20,](#b19)[22]](#b21). We use negative sampling as it is faster.

## Negative Sampling

Negative sampling is a form of Noise Contrastive Estimation (NCE) [[13]](#b12). NCE is an estimation technique that is based on the assumption that a good model should be able to separate signal from noise using only logistic regression.

As we only care about generating good embeddings, the objective function does not need to produce a well-speci ed probability distribution. The negative log likelihood using negative sampling is

$E = -log σ ( w O , w I ) - w j ∈W ne log σ (-w j , w I ) (4) = -log σ (u O ) - K j=1 E w j ∼P n [log σ (-u j )](5)$where w I , w O are the vector representation of the input and output vertices, u j = w j , w I , W neg is a set of samples drawn from the noise distribution, K is the number of samples and σ is the sigmoid function. The rst term represents the observed data and the second term the negative samples. To draw W neg , we specify the noise distribution P n to be unigrams raised to 3  4 as in [[18]](#b17).

## Model Learning

We learn the model using backpropagation. To perform backpropagation it is easiest to work in natural hyperbolic co-ordinates on the disk and map back to Euclidean co-ordinates only at the end. In natural co-ordinates r ∈ (0, ∞), θ ∈ (0, 2π ] and u j = r j r I cos(θ I -θ j ).

The major drawback of this co-ordinate system is that it introduces a singularity at the origin. To address the complexities that result from radii that are less than or equal to zero, we initialise all vectors to be in a patch of space that is small relative to its distance from the origin. The gradient of the negative log-likelihood in (5) w.r.t. u j is given by

$∂E ∂u j =          σ (u j ) -1, if w j = w O σ (u j ), if w j = W ne 0, otherwise(6)$Taking the derivatives w.r.t. the components of vectors in W (in natural polar hyperbolic co-ordinates) yields

$∂E ∂(r j ) k = ∂E ∂u j ∂u j ∂(r j ) k = ∂E ∂u j r I cos(θ I -θ j ) (7) ∂E ∂(θ j ) k = ∂E ∂u j r j r I sin(θ I -θ j ) . (8$$)$The Jacobian is then

$∇ r E = ∂E ∂r r + 1 sinh r ∂E ∂θ θ ,(9)$which leads to

$r new j = r old j -ηϵ j r I cos(θ I -θ j ), if w j ∈ w O ∪ W ne r old j , otherwise(10)$$θ new j = θ old j -ηϵ j r I r j sinh r j sin(θ I -θ j ), if w j ∈ w O ∪ W ne θ old j , otherwise (11$$)$where η is the learning rate and ϵ j is the prediction error de ned in Equation ( [6](#formula_4)). Calculating the derivatives w.r.t. the input embedding follows the same pattern, and we obtain

$∂E ∂r I = j:w j ∈w O ∪W ne ∂E ∂u j ∂u j ∂r I (12) = j:w j ∈w O ∪W ne ∂E ∂u j r j cos(θ I -θ j ) ,(13)$$∂E ∂θ I = j:w j ∈w O ∪W ne ∂E ∂u j ∂u j ∂θ I (14) = j:w j ∈w O ∪W ne - ∂E ∂u j r I r j sin(θ I -θ j ) .(15)$N -dim hidden layer  The corresponding update equations are

$V -dim input layer W V ×N W N ×V C × V -dim output layer x k h i [y 1j , ..., y Cj ] y 1j y Cj y 2j$$r new I = r old I -η j:w j ∈w O ∪W ne ϵ j r j cos(θ I -θ j ) ,(16)$$θ new I = θ old I -η j:w j ∈w O ∪W ne ϵ j r I r j sinh r I sin(θ I -θ j ) ,(17)$where t j is an indicator variable s.t. t j = 1 if and only if w j = w O , and t j = 0 otherwise. On completion of backpropagation, the vectors are mapped back to Euclidean co-ordinates on the Poincaré disk through θ h → θ e and r h → tanh r h 2 .

## EXPERIMENTAL EVALUATION

In this section, we assess the quality of hyperbolic embeddings and compare them to embeddings in Euclidean spaces on a number of public benchmark networks.

## Datasets

We report results on ve publicly available network datasets for the problem of vertex attribution.

(1) Karate: Zachary's karate club contains 34 vertices divided into two factions [[30]](#b29).

(2) Polbooks: A network of books about US politics published around the time of the 2004 presidential election and sold by the online bookseller Amazon.com. Edges between books represent frequent co-purchasing of books by the same buyers. (3) Football: A network of American football games between Division IA colleges during regular season Fall 2000 [[9]](#b8). (4) Adjnoun: Adjacency network of common adjectives and nouns in the novel David Copper eld by Charles Dickens [[23]](#b22). (5) Polblogs: A network of hyperlinks between weblogs on US politics, recorded in 2005 [[1]](#b0).

Statistics for these datasets are recorded in Table [1](#tab_1).

## Visualising Embeddings

To illustrate the utility of hyperbolic embeddings we compare embeddings in the Poincaré disk to the two-dimensional deepwalk embeddings for the 34-vertex karate network with two factions. The results are shown in Figure [4](#). Both embeddings were generated by running for ve epochs on an intermediate dataset of 34, ten step random walks, one originating at each vertex. The gure clearly shows that the hyperbolic embedding is able to capture the community structure of the underlying network. When embedded in hyperbolic space, the two factions (black and white discs) of the underlying graph are linearly separable, while the Deepwalk embedding does not exhibit such an obvious structure.

## Vertex Attribute Prediction

We evaluate the success of neural embeddings in hyperbolic space by using the learned embeddings to predict held-out labels of vertices in networks. In our experiments, we compare our embedding to deepwalk [[24]](#b23) embeddings of dimensions 2, 4, 8, 16, 32, 64 and 128. To generate embeddings we rst create an intermediate dataset by taking a series of random walks over the networks. For each network we use a ten-step random walk originating at each vertex.

The embedding models are all trained using the same parameters and intermediate random walk dataset. For deepwalk, we use the gensim [[25]](#b24) python package, while our hyperbolic embeddings are Figure [4](#): The factions of the Zachary karate network are easily linearly separable when embedded in 2D hyperbolic space. This is not true when embedding in Euclidean space. Both embeddings were run for 5 epochs on the same random walks written in custom TensorFlow. In both cases, we use ve training epochs, a window size of ve and do not prune any vertices.

The results of our experiments are shown in Figure [5](#). The graphs show macro F1 scores against the percentage of labelled data used to train a logistic regression classi er. Here we follow the method for generating F1 scores when each test case can have multiple labels that is described in [[17]](#b16). The error bars show one standard error from the mean over ten repetitions. The blue lines show hyperbolic embeddings while the red lines depict deepwalk embeddings at various dimensions. It is apparent that in all datasets hyperbolic embeddings signi cantly outperform deepwalk.

## CONCLUSION

We have introduced the concept of neural embeddings in hyperbolic space. To the best of our knowledge, all previous embeddings models have assumed a at Euclidean geometry. However, a at geometry is not the natural geometry of all data structures. A hyperbolic space has the property that power-law degree distributions, strong clustering and hierarchical community structure emerge naturally when random graphs are embedded in hyperbolic space. It is therefore logical to exploit the structure of the hyperbolic space for useful embeddings of complex networks. We have demonstrated that when applied to the task of classifying vertices of complex networks, hyperbolic space embeddings signi cantly outperform embeddings in Euclidean space.   Figure [5](#): Macro F1 score ( -axis) against percentage of labelled vertices used for training (x-axis). In all cases hyperbolic embeddings (blue) signi cantly outperform Euclidean deepwalk embeddings (red). Error bars show standard error from the mean over ten repetitions. The legend used in sub gure (a) applies to all sub gures. A consistent trend across the datasets is that an embedding into a 2D hyperbolic space outperforms deepwalk architectures with embeddings ranging from 2D to 128D.

![(a) "Circle Limit 1" by M.C. Escher illustrates the Poincaré disc model of hyperbolic space. Each tile is of constant area in hyperbolic space, but vanishes in Euclidean space at the boundary. (b) A set of straight lines in the Poincare disk that all pass through a given point and are all parallel to the blue (thicker) line.]()

![Figure 1: Illustrations of properties of hyperbolic space. a Tiles of constant area b Parallel lines.]()

![Figure 2: Geometric interpretation of the update equations in the Skipgram model. The vector representation of the output vertex (new) w O is moved closer (blue) to the vector representation of the input vertex I , while all other vectors (new) w j move further away (red). The magnitude of the change is proportional to the prediction error.]()

![Figure 3: The skipgram model predicts the context vertices from a single input vertex.]()

![(a) Zachary's karate network. The network is split into two factions. Two-dimensional hyperbolic embedding of the karate network in the Poincaré disk. Two dimensional Deepwalk embedding of the karate network.]()

![Description of experimental datasets. 'Largest class' gives the fraction of the dataset composed by the largest class and thereby provides the benchmark for random prediction accuracy.]()

