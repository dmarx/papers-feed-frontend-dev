# Probability Metrics for Tropical Spaces of Different Dimensions

## Abstract

## 

The problem of comparing probability distributions is at the heart of many tasks in statistics and machine learning. Established comparison methods treat the standard setting that the distributions are supported in the same space. Recently, a new geometric solution has been proposed to address the more challenging problem of comparing measures in Euclidean spaces of differing dimensions. Here, we study the same problem of comparing probability distributions of different dimensions in the tropical setting, which is becoming increasingly relevant in applications involving complex data structures such as phylogenetic trees. Specifically, we construct a Wasserstein distance between measures on different tropical projective tori-the focal metric spaces in both theory and applications of tropical geometry-via tropical mappings between probability measures. We prove equivalence of the directionality of the maps, whether mapping from a low dimensional space to a high dimensional space or vice versa. As an important practical implication, our work provides a framework for comparing probability distributions on the spaces of phylogenetic trees with different leaf sets. We demonstrate the computational feasibility of our approach using existing optimisation techniques on both simulated and real data.

## Introduction

Some of the most immediate and important tasks in statistics and machine learning-such as clustering [(Irpino & Verde, 2008)](#b16) and density estimation [(Sheather, 2004](#b31))-require measuring a distance between probability distributions. This is usually done with a notion of distance or divergence between measures; some of the most well-known distances and divergences between probability distributions are the Kullback-Leibler divergence, total variation distance, and Hellinger distance. These notions fall within the class of maps known in probability theory as f -divergences [(Csiszr, 1967)](#b8). More recently, the Wasserstein distance between measures has become increasingly relevant in statistics as it metrises weak convergence of measures and reflects the geometry of the underlying state space (e.g., [Panaretos & Zemel, 2019](#b27)[, 2020)](#b28).

An underlying assumption behind computing f -divergences and Wasserstein distances, however, is that the measures live in the same space. Nevertheless, there exist many application settings where the measures to be compared occur in distinct spaces of different dimensions. For example, phylogenetic trees are used to capture the progression of cancer in a biomedical application or the evolutionary patterns of the spread of disease in a public health application. In such applications, the numbers of leaves in the trees can differ before and after intervention such as treatment or public inoculation, and therefore such datasets will lie on spaces of different dimensions. Existing work by [Ren et al. (2017)](#b30) and [Grindstaff & Owen (2019)](#b13) study the problem of comparing sets of trees with differing numbers of leaves in BHV tree space [(Billera et al., 2001)](#b4); here, we consider probability measures rather than discrete data sets in tropical tree space [(Speyer & Sturmfels, 2004)](#b32).

There is an inherent connection between the space of phylogenetic trees and tropical geometry [(Speyer & Sturmfels, 2004)](#b32), which has recently been exploited to develop many statistical and machine learning tools for sets of phylogenetic trees (e.g., [Barnhill et al., 2023;](#b3)[Tang et al., 2024;](#b34)[Yoshida et al., 2019;](#b37)[Aliatimis et al., 2024)](#b0). The ambient space of phylogenetic trees as well as Gröbner complexes-central objects in tropical geometry-is the tropical projective torus, which makes it a fundamental space in tropical geometry for both theory and applications. In this work, we therefore study Wasserstein distances between probability distributions on tropical projective tori of different dimensions.

Our strategy is to leverage recent work in the Euclidean setting by [Cai & Lim (2022)](#b6), who construct a Wasserstein distance between Euclidean spaces of different dimensions. The optimal transport problem and thus Wasserstein distances are well defined and have been previously studied on the tropical projective torus by [Lee et al. (2022)](#b20). In this work, we build on these existing results and relevant foundations to construct a Wasserstein distance between measures on tropical projective tori of different dimensions. We prove that there need not be a choice of whether to map from the lower dimensional torus to the higher dimensional one or vice versa, because the directional mappings are equivalent.

The remainder of this manuscript is structured as follows. We begin with an outline of the relevant background and concepts in Section 2. We then characterise the tropical equivalents to the necessary tools in Section 3, which leads to our main theorem and a discussion of practical implications for phylogenetic trees in Section 4. Section 5 consists of numerical experiments for the computation of our proposed distance and a demonstration of our algorithm using real influenza data. We close with a discussion of future work in Section 6.

Throughout this manuscript we use the term polyhedron to refer to a (possibly unbounded) finite intersection of closed half spaces of dimension d, in accordance with [Ziegler (2012)](#b40).

## Background and Preliminaries

In this section, we present the tropical setting of our work, the Wasserstein distance definition, and an overview of the approach for mapping between probability distributions of different dimensions in the Euclidean case, which we will closely follow in our work.

Notation. Throughout this manuscript, we use the notation [n] := {1, 2, . . . , n}.

## Essentials of Tropical Algebra and Geometry

We begin by outlining the basic concepts of tropical algebra and tropical geometry needed for our work; a complete introduction is given by [Maclagan & Sturmfels (2015)](#b23).

## Tropical Algebra and Phylogenetics

Definition 1 (Tropical Algebra). The tropical algebra is the semiring R = R ∪ {-∞} with the addition and multiplication operators-tropical addition and tropical multiplication, respectively-given by a ⊞ b = max{a, b}, a ⊙ b = a + b.

The additive identity is -∞ and the multiplicative identity is 0. Tropical subtraction is not defined; tropical division is given by classical subtraction.

Remark 2. Note that [Maclagan & Sturmfels (2015)](#b23) use the min-plus convention where tropical addition is given by the minimum between two elements, rather than the maximum as above. While they are equivalent, we use the max-plus convention as this has been used more frequently in recent applications (e.g., [Yoshida et al., 2019](#b37)[Yoshida et al., , 2023;;](#b38)[Aliatimis et al., 2024)](#b0).

Using the tropical algebra, we can define tropical parallels to most algebraic objects. For example, we can define tropical polynomials as the maximum of finitely many linear maps with integer coefficients. Evaluating functions or other mathematical expressions using the tropical algebra is referred to as tropicalisation.

The metric space in which we work is the following.

Definition 3 (Tropical projective torus, Tropical metric). The n-dimensional tropical projective torus is a quotient space constructed by endowing R n+1 with the equivalence relation

$x ∼ y ⇔ x = a ⊙ y;(1)$it is denoted by R n+1 /R1. The generalised Hilbert projective metric, also referred to as the tropical metric, is given by

$d tr (x, y) = max i {x i -y i } -min i {x i -y i } = max i,j {x i -y i -x j + y j },$and is induced by the tropical norm ∥x∥ tr = max

$i x i -min i x i .$As we are mapping between tropical projective tori of different dimensions, when necessary we will distinguish between metrics on different spaces by denoting the R n /R1 metric by d n tr . Figure [1](#fig_0) shows the tropical ball on the tropical projective plane, where we have normalised the first coordinate to embed into R 2 . We use this embedding, given more generally by

$φ : R n+1 /R1 → R n , (x 0 , . . . , x n ) → (x 2 -x 0 , . . . , x n -x 0 ),$for all visualisation figures in this paper. 

## Phylogenetic Trees

The space of phylogenetic trees with N leaves, which are metric N -trees with non-negative lengths on all edges, have an important connection to tropical geometry. It was proved by [Speyer & Sturmfels (2004)](#b32) that the tropical Grassmannian-the projective variety obtained by tropicalising the Grassmannian-is homeomorphic to the space of phylogenetic trees, and therefore the tropical projective torus is the ambient space of phylogenetic trees. Phylogenetic trees are a fundamental data type in biology that model evolutionary processes in many settings, such as the evolution of species and disease, as well as the spread of pathogens. The tropical projective torus, therefore, is an important space in mathematical biology as the ambient space of phylogenetic trees.

## Tropical Matrices

To respect the tropical structure of the tropical projective torus, we use tropical matrices to map probability distributions from one tropical projective torus to another. Here we outline the behaviour of tropical matrix maps and their connections to tropical convexity as first presented by [Develin & Sturmfels (2004)](#b9) and discussed in Chapter 5.2 of [Maclagan & Sturmfels (2015)](#b23). The foundational objects of convexity analysisline segments and convex hulls -are defined in the tropical setting as follows:

Definition 4 (Tropical line segment, Tropical convex hull). For any two points a, b ∈ R n /R1, the tropical line segment between a and b is the set

$γ ab = {α ⊙ a ⊞ β ⊙ b | α, β ∈ R}$with tropical addition taken coordinate-wise.

For a finite subset X = {x 1 , . . . , x r } ⊂ R n /R1, the tropical convex hull of X is the smallest subset containing X where the tropical line segment between any two points in X is contained in X; it is the set of all tropical linear combinations of X,

$tconv(X) = {α 1 ⊙ x 1 ⊞ α 2 ⊙ x 2 ⊞ • • • ⊞ α r ⊙ x r | α 1 , . . . , α r ∈ R}.$We will be studying tropical matrices M ∈ R m×n with at least one real entry per row-a non-degeneracy condition which ensures M maps into R m /R1. This condition is assumed through the rest of the manuscript. From the definition above, we can observe that the image of a tropical matrix M in R m /R1 is the tropical span of the columns of M ; when M has all real entries, its image in R m /R1 is the tropical convex hull of its columns [(Maclagan & Sturmfels, 2015)](#b23).

$Example 5. Let M :=   2 0 0 -2 2 1 1 3 -1   .$Its image is given in Figure [2](#).

(2, 3)

$(1, -1) (-4, -1) Figure 2: The image of M from Example 5 under φ : R 3 /R1 → R 2 .$The local behaviour of tropical matrices is classically linear, but to understand the global behaviour of their images and fibres, we must understand the combinatoric structure of tropical matrices. This combinatoric information is given by the type at a point x, and dictates the local behaviour at x. Definition 6. Let M ∈ R m×n . The type of a point x ∈ R n /R1 with respect to M is the n-tuple S = (S 1 , . . . , S n ), where

$S j = {i ∈ [m] : (M x) i = M i• ⊙ x attains its maximum at M ij + x j }.$The type of a point is denoted by type(x). The set of all points with type S forms a convex polyhedron which is denoted by

$X S := {x ∈ R n /R1 : S ⊆ type(x)}.$Note that the type sets S cover [m]. This definition is given by [Develin & Sturmfels (2004)](#b9) for real-valued matrices; we note it is also valid for matrices with -∞ entries.

Intuitively, S j is the set of coordinates i of M x that depend on the jth coordinate of x; in neighbourhoods where S j = ∅ then M x is invariant under changes to x j , and in neighbourhoods where S j = [m] for some j then M x takes the form x j ⊙ M •j and is therefore constant due to the equivalence relation on the tropical projective torus.

The collection of all type cells X S form a cell decomposition of R n /R1 (Theorem 15 by [Develin & Sturmfels (2004)](#b9)) where X S ≤ X T if, and only if, ∀ j, T j ⊆ S j . For any two types S and T , X S ∩X T = X S∪T . Figure [3](#fig_1) shows the cell decomposition for a 2×3 matrix, and the local classically linear form of M x according to the type.

## Wasserstein Distances Between Probability Distributions

Wasserstein distances measure distances between probability distributions. They arise as a certain class of optimal transport problem, with applications in PDEs, image processing, optimisation and statistics. As opposed to f -divergences, they preserve the geometry of the state space over which they are defined and metrise weak convergence results such as the central limit theorem (e.g., [Lee et al., 2022, Section 3.1)](#).

$(0, a -b, a -c) (0, d -e, d -f ) Type: ({1, 2}, ∅, ∅) M x = (a + x1, d + x1) Type: ({2}, ∅, {1}) M x = (c + x3, d + x1) Type: (∅, ∅, {1, 2}) M x = (c + x3, f + x3) Type: (∅, {1}, {2}) M x = (b + x2, f + x3) Type: (∅, {1, 2}, ∅) M x = (b + x2, e + x2) Type: ({2}, {1}, ∅) M x = (b + x2, d + x1)$The Wasserstein distance is a solution to a particular case of the optimal transport problem, first introduced by [Monge (1781)](#b25). The optimal transport problem is the search for an optimal mapping to transport a set of resources from their sources to sinks which minimises the transport cost. When the cost function is given by a distance between source and sink, the solution to the optimal transport problem yields the Wasserstein distances. The space on which the source and sink locations are located is referred to as the state space, while the physical distance that the resources need to be transported is measured by the ground metric.

The optimal transport problem was then relaxed to a probabilistic framework [(Kantorovich, 1942)](#b17). The question is then to find the optimal coupling of two random variables which minimises the expectation of a cost function; when the cost function is the ground metric of the state space, the solution to the problem gives the Wasserstein distance between probability measures. Definition 7 (p-Wasserstein Distance). Let (Ω, d) be a Polish metric space and p ∈ [1, ∞). Let µ, ν ∈ P (Ω) and let Π(µ, ν) be the set of all couplings of µ and ν. The p-Wasserstein distance W p on P (Ω) is defined by

$W p (µ, ν) p := inf π∈Π(µ,ν) E (X,Y )∼π [d(X, Y ) p ] .$The p-Wasserstein distance is not necessarily finite on all of P (Ω), but will be finite on measures with finite p-moments, which we denote by P p (Ω) [(Villani, 2009](#b36)[(Villani, , 2003))](#b35). The tropical projective torus is a Polish space [(Monod et al., 2018)](#b26), while the tropical p-Wasserstein distance is well-defined and has been previously studied by [Lee et al. (2022)](#b20) using the tropical projective torus as the state space and the tropical metric as the ground metric.

## Wasserstein Distances Between Euclidean Spaces of Different Dimensions

To measure differences between probability distributions supported on Euclidean space of different dimensions, [Cai & Lim (2022)](#b6) constructed a Wasserstein pseudo-metric; it is a pseudo-metric in that it is symmetric and positive up to isometries. They note this pseudo-metric reflects well-understood properties of certain families of measures, as well as demonstrating computational advantages over the Gromov-Wasserstein distance [(Mémoli, 2011)](#b24). We look to mirror their approach in the more complex tropical setting. [Cai & Lim (2022)](#b6) also establish the same results for f -divergences, but we will restrict our considerations to Wasserstein distances due to their inherently geometric behaviour; this behaviour is favourable for applications where our data has a tropical structure such as phylogenetic tree data.

We will leverage the approach of [Cai & Lim (2022)](#b6) in our work and so we provide an outline of their strategy here. Suppose we have two measures, µ, ν in P p (R m ) and P p (R n ) respectively, with m ≤ n; we suppose there is no known correspondence between the coordinate systems of R m and R n , even if m = n.

Both measures are required to be on the same state space to take a Wasserstein distance, so [Cai & Lim (2022)](#b6) define their projections of interest as those composed of a semi-orthogonal matrix and a translation:

$M = {ϕ : R n → R m : ϕ(x) = Ax + b, A ∈ O(m, n), b ∈ R m }.$Then the sets of projection and embedding measures are defined as, respectively,

$Φ -(ν, m) := {β ∈ P (R m ) : β = ϕ * (ν) for some ϕ ∈ M}, Φ + (µ, n) := {α ∈ P (R n ) : µ = ϕ * (α) for some ϕ ∈ M},$where ϕ * (α) denotes the push-forward of α; that is, ϕ * (α)(A) = α(ϕ -1 (A)).

From these projected and embedded measures, the projection and embedding Wasserstein distances are defined respectively by

$W - p (µ, ν) = inf β∈Φ -(ν,m) W p (µ, β),(2)$$W + p (µ, ν) = inf α∈Φ + (µ,n) W p (α, ν).(3)$While both the projection and embedding distances offer an intuitive measure for comparing µ and ν, it is not obvious which would be more meaningful in practice: to map from the lower dimensional space to the higher dimensional one, or vice versa. The main result by [Cai & Lim (2022)](#b6) tells us we need not make an arbitrary choice; the two distances are equal.

$Theorem 8. (Cai & Lim, 2022, Theorem 2.2) For m ≤ n, p ∈ [1, ∞], let µ ∈ P p (R m ), ν ∈ P p (R n ). Then W -(µ, ν) = W + (µ, ν)$where W -and W + are defined by (2) and (3).

The focal contribution of our work is a tropical parallel to the framework of [Cai & Lim (2022)](#b6), allowing us to map between probability measures in tropical projective tori of different dimensions and establish the same metric equivalence in the more complex tropical setting.

## Building Tropical Tools

To build up to the tropical equivalent of Theorem 8, we first require tropical counterparts of central objects to the construction by [Cai & Lim (2022)](#b6). Specifically, we require a semi-orthogonal map in the tropical setting. Notice that in our setting, the equivalence relation (1) defining the tropical projective torus must always be preserved in mappings.

## Tropical Matrix Maps

Standard linear maps fail to preserve the equivalence relation (1) that characterizes the tropical projective torus, making them unsuitable for our aim of mapping between tropical projective tori. Instead, we consider tropical linear maps. We now review the properties of general tropical matrices, highlighting their irregular properties; namely, that tropical matrices can have bounded image and fibres of different dimension.

## Metric Geometry Under Tropical Linear Maps.

To formulate Wasserstein distances over tropical linear maps, we must understand their metric geometry.

Here we prove a useful property of tropical linear maps, namely that they are always non-expansive with respect to the tropical metric.

Proposition 9. For any tropical matrix M :

$∀ x, y ∈ R n /R1 : d tr (M x, M y) ≤ d tr (x, y)$Proof. There exist coordinates r, s such that

$d tr (M x, M y) = max i {M ri + x i } -max j {M rj + y j } -max k {M sk + x k } + max ℓ {M sℓ + y ℓ },$Fix i, j, k, ℓ as the maximal arguments for the terms above. Then

$d tr (M x, M y) = M ri + x i -(M rj + y j ) -(M sk + x k ) + M sℓ + y ℓ ≤ M ri + x i -(M ri + y i ) -(M sℓ + x ℓ ) + M sℓ + y ℓ ≤ x i -y i -x ℓ + y ℓ ≤ d tr (x, y).$In light of Proposition 9, we note the non-expansive property is more restrictive in the Euclidean setting than the tropical setting; every tropical matrix map is non-expansive, but not every Euclidean matrix map is non-expansive.

## Images of Tropical Matrices.

To define embedded measures, we must take a pull-back through M ; this requires the image of M to cover the support of our measure µ ∈ P p (R m /R1). However, tropical matrices often have bounded image, as we saw in Example 5. The following result characterises surjectivity for tropical matrix maps.

Lemma 10. A tropical matrix map M is surjective on R m /R1 if and only if, for each row i, there is at least one column c(i) such that

$M r,c(i) ∈ -∞ if r ̸ = i, R if r = i.(4)$Proof. Suppose M is surjective. Then let x be such that M x = [(0, . . . , K, . . . , 0)], where only the i-th entry is K, and K is a positive real number such that

$K > max{M i0j0 -M i1j1 : M i0j0 , M i1j1 ∈ R}. Let j ∈ [n] be some coordinate such that (M x) i = M ij + x j = K. If M lj is real for any other coordinate, then 0 = (M x) l ≥ M lj + x j = M lj -M ij + M ij + x j = M lj -M ij + K > 0,$a contradiction. Notice that the final equality comes from the definition of x, while the last equality is a consequence of the definition of K.

To prove the other direction, let us consider y = (y 1 , . . . , y m ) ∈ R m /R1. For each i ∈ [m], we can pick some column c(i) that satisfies (4). Let I := {c(i) : i ∈ [m]}. Then we define K as before and define

$x = (x 1 , . . . , x n ) ∈ R n /R1 by x j := y i -M i,c(i) if j = c(i), min i∈[m] {-K -y i + M i,c(i) } j / ∈ I$By direct computation, we can check that the maximum for each row i is achieved at c(i) and that the value is exactly y i .

## Fibres of Tropical Matrices.

The semi-orthogonal projections used by [Cai & Lim (2022)](#b6) are well-behaved in the sense that they preserve some of the structure of ν ∈ P p (R n ). For example, a push-forward through a semi-orthogonal projection cannot increase the co-dimension of a measure [(Heurteaux, 2007)](#b14), as each fibre has dimension n -m. It is the fibres of M which determine the dimensionality of a projected measure and are therefore central to our work.

Definition 11. The fibre of M at a point y ∈ R m /R1 is given by

$F y = {x ∈ R n /R1 : M x = y}. Example 12. Let M := a b c d e f$, as in Figure [3](#fig_1). If S j is empty at x, then M x is locally independent of e j ; from this we can draw the fibres of M , as illustrated in Figure [4](#fig_2) -points of the same colour are mapped to the same point by M .

(0, a -b, a -c)

$(0, d -e, d -f ) Type: ({1, 2}, ∅, ∅) M x = (a + x1, d + x1) Type: ({2}, ∅, {1}) M x = (c + x3, d + x1) Type: (∅, ∅, {1, 2}) M x = (c + x3, f + x3) Type: (∅, {1}, {2}) M x = (b + x2, f + x3) Type: (∅, {1, 2}, ∅) M x = (b + x2, e + x2)$Type: ({2}, {1}, ∅) The following lemma characterises the fibres of general tropical matrices as polyhedral complexes; this can be seen as a refinement of Theorem 15 by [Develin & Sturmfels (2004)](#b9).

$M x = (b + x2, d + x1)$Lemma 13. The fibres

$F y = {x ∈ R n /R1 : M (x) = y} of a general tropical matrix M are (unbounded) polyhedral complexes.$Proof. For a given type S, we define

$B S y := i∈[m] {x ∈ R n /R1 : x j -x k = M 1k -M ij + y i -y 1 | 1 ∈ S k , i ∈ S j }.$Then we define C S y := X S ∩ B S y and let C y := {C S y : S is a type}. We will show that C y is a polyhedral complex in R n /R1. Since for every type S, both X S and B S y are polyhedra in R n /R1, C S y is a well-defined polyhedron in R n /R1 as well.

We first prove C y is closed under intersections. Consider two types S and T ; we can write

$C S y ∩ C T y as (X S ∩ X T ) ∩ (B S y ∩ B T y ) = X S∪T ∩ (B S y ∩ B T y )$and we will prove this last term is equal to

$X S∪T ∩ B S∪T y . By definition, B S∪T y is equal to: i∈[m] {x ∈ R n /R1 : x j -x k = M 1k -M ij + y i -y 1 | 1 ∈ S k ∪ T k , i ∈ S j ∪ T j }.$We see that B S∪T y ⊂ B S y ∩ B T y , so it remains to show that for any x ∈ X S∪T ∩ (B S y ∩ B T y ), x belongs to B S∪T y as well. This amounts to proving that:

$x j -x k = M 1k -M ij + y i -y 1 , ∀i ∈ [m], 1 ∈ S k ∪ T k , i ∈ S j ∪ T j .$Let i, j, k be such that 1 ∈ S k and i ∈ S j . In this case, the equation holds trivially based on the definition of B S y . Similarly, if 1 ∈ T k and i ∈ T j we are done. So, the remaining case is the one in which 1 ∈ S k and i ∈ T j . We consider j 0 such that i ∈ S j0 , notice that this exists since S covers [m]. Since x ∈ X S∪T the following equation holds:

$M ij + x j = M ij0 + x j0 = y i , implying that x j = M ij0 -M ij + x j0$. Now we can write x j -x k in the following form:

$x j -x k = M ij0 -M ij + x j0 -x k = M ij0 -M ij + M 1k -M ij0 + y i -y 1 = M 1k -M ij + y i -y 1 ,$where for the first equality we used that x ∈ B S y . Notice that we don't need to prove the case in which 1 ∈ T k and i ∈ S i , as the roles of S and T are equivalent and so the same proof applies swapping their roles. So we proved that C y is closed under intersection.

We prove now that the faces of elements of C y are contained in C y . Since by definition B S y is an affine space for any type S, the faces of C S y are of the form X T ∩ B S y where X T is one of the faces of X S ; that is,

$S ≤ T . It suffices to show now that X T ∩ B S y = X T ∩ B T y . As S ≤ T , it is immediate that B T y ⊂ B S y . It remains to show that for all x ∈ X T ∩ B S y we have x ∈ B T y . Consider i, j, k such that 1 ∈ T k , i ∈ T j ; we will show that x j -x k = M 1k -M ij + y i -y 1 . As S covers$[m] and we have S ≤ T , there are some k ′ , j ′ such that 1 ∈ S k ′ , T k ′ and i ∈ S j ′ , T j ′ . For all x ∈ X T we have

$x k + M 1k = x k ′ + M 1k ′ , x j + M ij = x j ′ + M ij ′ .$Hence, for all x ∈ X T ∩ B S y :

$x j -x k = x j ′ + M ij ′ -M ij -x k ′ -M 1k ′ + M 1k , = y i -M ij -y 1 + M 1k ,$where the first equality uses that x ∈ X T and the second equality uses that x ∈ B S y . We conclude that x ∈ B T y , and hence that C y is closed under taking faces.

In order to complete the proof, it only remains to show that F y = ∪ S C S y . We know that R n /R1 = ∪ S X S , which implies that F y = ∪ S (X S ∩ F y ). So it is enough to prove that X S ∩ F y = X S ∩ B S y . We start by proving X S ∩ F y ⊆ X S ∩ B S y . Consider i ∈ [n] and k, j ∈ [m], such that 1 ∈ S k and i ∈ S j , and fix x ∈ X S ∩ F y . It follows from the definition of types that:

$(M x) i -(M x) 1 = x j + M ij -x k -M 1k .$(5)

We can therefore write x j -x k as

$x j -x k = M 1k -M ij + (x j + M ij ) -(M 1k + x k ) = M 1k -M ij + (M x) i -(M x) 1 (6) = M 1k -M ij + y i -y 1 ,$where the penultimate equality is given by ( [5](#)) and the final equality follows from x ∈ F y . Hence x ∈ B S y , so we have

$X S ∩ F y ⊆ X S ∩ B S y . Finally, we show X S ∩ B S y ⊆ F y by direct computation. For i, j, k such that 1 ∈ S k and i ∈ S j : (M x) i -(M x) 1 = M ij + x j -M 1k -x k = y i -y 1 ,$where the first equality follows from x ∈ X S and the second equality follows from x ∈ B S y . Therefore the fibre F y = ∪ S C S y is a polyhedral complex, as desired.

Remark 14. From our proof of Lemma 13, we note that the poset of fibre cells C S y is given by a reverse type inclusion as in the case of type cells [(Develin & Sturmfels, 2004)](#b9). Therefore, the maximal cells C S y of the fibre are exactly those whose type is given by a partition of [m] (and copies of the empty set).

We see in Figure [4](#fig_2) that fibre polyhedral complexes can have mixed dimension. A push-forward M (ν) through such matrices can preserve little to none of the structure of ν due to this irregular fibre dimension. We would therefore like to restrict our considerations to matrices with fibres of consistent dimension n -m. In the next section we identify the set of such matrices as the set of simple projections.

## Simple Projections

In addition to the assumption that the tropical matrices we study have at least one real entry per row as specified above, the following class of tropical matrices-simple projections-have the necessary properties for our task of constructing our tropical Wasserstein distance.

Definition 15 (Simple Projection). A tropical matrix M ∈ R m×n , where n > m, is called a simple projection when each column has at most one real entry.

For M , we define J i := {j : M ij ∈ R}. These sets are disjoint and non-empty, but do not necessarily cover [[n]](#). Then

$(M x) i = max j∈Ji {M ij + x j }.(7)$The following relationship establishes when a tropical matrix is a simple projection in terms of the dimensionality of its fibres.

Lemma 16. M is a simple projection if and only if, for all y ∈ R m /R1, every maximal cell of the fibre F y has dimension n -m.

Proof. We will show that the following are equivalent:

1. M is a simple projection, 2. for all y, the maximal cells of the fibre F y have dimension n -m, 3. the maximal cells X S of the type cell decomposition of R n /R1 correspond to types consisting of m singletons and n -m empty sets.

We first show that 2 ⇔ 3. By Remark 14 a fibre cell C S y is maximal iff S is a partition which is equivalent to X S being a maximal cell. For such an S, we define the classical matrix M S ∈ R m×n and b S ∈ R m as follows

$M S i,j := 1, if i ∈ S j , 0, if i / ∈ S j b i := M i,j(i) ,$where j(i) is the only j such that i ∈ S j . From this, we directly notice that the restriction of M to X S is given by the classically affine operator mapping

$x ∈ R n to M S • x + b S ∈ R m$, where here, matrix-vector multiplication is computed in the usual non-tropical manner. The dimension the maximal fibre cell C S y in X S is then given by the dimension of the kernel of M S . Since this is a 0/1 matrix with one non-zero entry per row, we may use a standard linear algebra argument to derive that

$KerM S = |{j ∈ [m] : M S •,j = 0}| = |{j ∈ [m] : S j = ∅}| ≤ n -m.$From this we can deduce that every maximal type cell has exactly m non-empty S j if and only if, ∀ y ∈ R m /R1, every maximal cell in F y has dimension n -m. As S is a partition, we conclude that 2 ⇔ 3. We next show that 1 ⇔ 3. Suppose for contradiction that M is not a simple projection, but for every maximal type cell X S , the type S consists of singletons. Then for some j ∈ [n] and i 0 ̸ = i 1 ∈ [m], both M i0j and M i1j are real. We set

$B := min{min(M i0j -M i0k , M i1j -M i1k ) : k ∈ [n]} U := {x ∈ R n /R1 : x k -x j ≤ -B for k ∈ [n] \ {j}}.$U is a full dimensional polyhedron in R n /R1, so there is some maximal X S such that dim(X S ∩U ) = dim(X S ). By construction, for all x ∈ U and all k ∈ [n],

$M i0k + x k ≤ M i0j + x j , M i1k + x k ≤ M i1j + x j ,$and hence i 0 , i 1 ∈ S j on U j . Contradiction. To show the converse, suppose that M is a simple projection. Then for all x in a maximal type cell X S , i ∈ S j for some j ∈ J i . As the J i are disjoint, each S j is either ∅ or a singleton.

We can verify that simple projections satisfy the condition of Lemma 10 by their definition, and hence are surjective. By Lemma 16, they also have fibres of dimension n -m. We conclude that simple projections are the most general tropical matrices satisfying these properties. In Lemma 17 and Proposition 18 we now use these properties of simple projections to construct a homeomorphism f M between R n /R1 and R m /R1 × F 0 which is crucial for our main theorem.

Lemma 17. Let M be a simple projection from R n /R1 to R m /R1 and let F 0 be the fibre of M at 0 ∈ R m /R1. We define a map

$f M : R n /R1 → R m /R1 × F 0 by mapping x ∈ R n /R1 to (M x, x -z x ) ∈ R m /R1 × R n /R1$, where z x is defined as follows:

$z x j := (M x) i -max k (M x) k j ∈ J i , 0 j / ∈ ∪ i∈[n] J i . (8$$)$The map f M is a well-defined map.

Proof. We must prove that this map respects the equivalence class defining R n /R1. This amounts to proving that for all c ∈ R and all

$x ∈ R n /R1, f M (x) ∼ f M (c ⊙ x).$Let us start by considering z c⊙x , which, from (8), is given by

$z c⊙x j = (M (c ⊙ x) i -max k (M (c ⊙ x) k ) = M (x) i -max k (M x) k j ∈ J i 0 j / ∈ ∪ i J i , so it is equal to z x . Therefore we can write f M (c ⊙ x) as (c ⊙ M x, c ⊙ x -z x ) = (c ⊙ M x, c ⊙ (x -z x )) ∼ (M x, x -z x ) = f M (x), therefore proving that f M is well defined. We now prove that Im f M ⊂ R m /R1 × F 0 . It suffices to show x -z x ∈ F 0 , which can be done by writing M (x -z x ) i for each i ∈ [m] as max j∈Ji {M ij + x j -(M x) i -max k (M x) k } = max j∈Ji {x j + M ij } -(M x) i -max k (M x) k = -max k (M x) k ,$which is independent of i, and hence M (x -z x ) ∼ 0. Notice that for the first equality, we may take (M x) i and max k (M x) k out of the maximum since they are independent of j, while for the second equality we use the simple projection definition.

Proposition 18. The map f M defined in Lemma 17 is a homeomorphism between R n /R1 and R m /R1 × F 0 satisfying

$1 3 d R m /R1×F0 (f (x 1 ), f (x 2 )) ≤ d n tr (x 1 , x 2 ) ≤ d R m /R1×F0 (f (x 1 ), f (x 2 )), (9$$)$$where d R m /R1×F0 ((u 1 , v 1 ), (u 2 , v 2 )) = d m tr (u 1 , u 2 ) + d n tr (v 1 , v 2 ).$Proof. We begin by showing the surjectivity of f M . Consider (y, u) in R m /R1 × F 0 and define

$w j := y i -max k y k j ∈ J i 0 j / ∈ ∪ i J i .$We will show f M (w + u) ∼ (y, u). Let us start by considering the entries of M (w + u), which we can write in the following way:

$M (w + u) i = max j∈Ji {M ij + y i -max k y k + u j } = max j∈Ji {M ij + u j } + y i -max k y k = y i -max k y k ,$implying that M (w + u) = y and w = z w+u . This then implies that:

$f M (w + u) = (y, w + u -w) = (y, u), hence f M is surjective.$In order to show injectivity, consider

$x 1 , x 2 ∈ R n /R1 such that f M (x 1 ) ∼ f M (x 2$). This means that there are c 1 , c 2 ∈ R where:

$M x 2 = c 1 ⊙ M x 1 ,(10)$$x 1 -z x 1 = c 2 ⊙ (x 2 -z x 2$). ( [11](#))

From ( [8](#formula_46)) we see that (10) implies z x 1 = z x 2 . We can rewrite (11) as

$∀ j ∈ [n] : x 1 j = z x 1 j + c 2 + x 2 j -z x 2 j = z x 2 j + c 2 + x 2 j -z x 2 j = c 2 + x 2 j from which we deduce x 1 ∼ x 2 , proving f M is a bijection.$Finally, we prove that f M is an homeomorphism, i.e., f M and f -1 M are both continuous, by proving the metric equivalence (9). First, note that

$z x 1 j -z x 2 j = (M x 1 ) i -max k (M x 1 ) k -(M x 2 ) i + max k (M x 2 ) k j ∈ J i 0 j / ∈ ∪ i J i , so we consider r 1 , r 2 ∈ [m] such that (M x 1 ) r1 = max k (M x 1 ) k and (M x 2 ) r2 = max k (M x 2 ) k . We then have z x 1 r1 -z x 2 r1 ≥ 0, z x 1 r2 -z x 2 r2 ≤ 0.(12)$Hence,

$d n tr (z x 1 , z x 2 ) = ∥z x 1 -z x 2 ∥ tr = max a,b∈[n] {z x 1 a -z x 2 a -z x 1 b + z x 2 b } = max a,b∈∪iJi {z x 1 a -z x 2 a -z x 1 b + z x 2 b } = max r,s∈[m] {(M x 1 ) r -(M x 2 ) r -(M x 1 ) s + (M x 2 ) s } = d m tr (M x 1 , M x 2 ). (13$$)$Notice that (12) allows us to restrict the maximum to ∪ i J i , as for all j not in ∪ i J i we have that z x 1 j -z x 2 j = 0. We now prove the first half of (9). Firstly, by the triangle inequality, (13), and the non-expansivity of M (Proposition 9), we note:

$1 3 d n tr (x 1 -z x 1 , x 2 -z x 2 ) = 1 3 ∥x 1 -z x 1 -x 2 + z x 2 ∥ tr ≤ 1 3 ∥x 1 -x 2 ∥ tr + ∥z x 2 -z x 1 ∥ tr = 1 3 d n tr (x 1 , x 2 ) + d m tr (M x 1 , M x 2 ) ≤ 2 3 d n tr (x 1 , x 2 ).$Adding this to the non-expansive inequality gives us the left hand inequality of ( [9](#formula_50)):

$1 3 d m tr (M x 1 , M x 2 ) + 1 3 d n tr (x 1 -z x 1 , x 2 -z x 2 ) ≤ d n tr (x 1 , x 2 ).$We now prove the second half of (9):

$d n tr (x 1 , x 2 ) = ∥x 1 -z x 1 -x 2 + z x 2 + z x 1 -z x 2 ∥ tr ≤ ∥x 1 -z x 1 -x 2 + z x 2 ∥ tr + ∥z x 1 -z x 2 ∥ tr = d n tr (x 1 -z x 1 , x 2 -z x 2 ) + d m tr (M x 1 , M x 2 ),$where we used the triangle inequality and ( [13](#formula_61)). This shows strong equivalence of the metrics, proving that f is a homeomorphism.

This product space structure of R n /R1 will allow us to prove that when optimising over simple projections, the projective and embedding Wasserstein distances on tropical projective tori are the same.

## Tropical Wasserstein Mappings for Different Dimensions

Given the tropical tools and results established above, we are now equipped to present our main theoretical result; when we use simple projections as our inter-dimensional tropical maps, the projection and embedding Wasserstein distances coincide as in the Euclidean case.

Following the presentation of our main result in this section, we discuss implications of our work in the setting of phylogenetic trees.

## Equivalent Tropical Wasserstein Distances

We define our set of simple projections from R n /R1 to R m /R1 by

$M tr := {ϕ M : R n /R1 → R m /R1 : ϕ M (x) = M x where M is a simple projection}.$We note each ϕ ∈ M tr is measurable as it is continuous.

The sets of projected and embedded measures Φ 

$W - tr,p (µ, ν) = inf β∈Φ - tr (ν,m) W tr,p (µ, β), W + tr,p (µ, ν) = inf α∈Φ + tr (µ,n) W tr,p (α, ν).$We begin by establishing the following lemma, which verifies that simple projections are non-expansive on P p (R n /R1) as well as on R n /R1. Proposition 19. For all p ∈ [0, ∞), ϕ ∈ M tr and α, ν ∈ P p (R n /R1), we have

$W tr,p (ϕ * (α), ϕ * (ν)) ≤ W tr,p (α, ν).$Proof. This proof follows the same approach as the proof of Lemma 2.1 by [Cai & Lim (2022)](#b6).

Let π ∈ P ((R n /R1) 2 ) be the optimal transport coupling for α and ν. Then define π m ∈ P ((R m /R1) 2 ) as the push-forward of π through ϕ × ϕ:

$π m (A × B) = π(ϕ -1 (A) × ϕ -1 (B)).$Checking the marginals of π m , we have

$π m (A, R m /R1) = π(ϕ -1 (A) × R n /R1) = α(ϕ -1 (A)) = ϕ * (α)(A), π m (R m /R1, B) = π(R n /R1 × ϕ -1 (B)) = ν(ϕ -1 (B)) = ϕ * (ν)(B).$Therefore, π m is a coupling of ϕ * (α) and ϕ * (ν). We can then bound the Wasserstein distance between ϕ * (α) and ϕ * (ν) by:

$W tr,p (ϕ * (α), ϕ * (ν)) p ≤ E (X,Y )∼πm [d tr (X, Y ) p ] = E (U,V )∼π [d tr (ϕ * (U ), ϕ * (V )) p ] ≤ E (U,V )∼π [d tr (U, V ) p ] = W tr,p (α, ν) p ,$where for the last inequality, we used the non-expansive property (Proposition 9).

Remark 20. Notice that although stated for simple projections, in the proof, we only used the non-expansive property so the proposition holds for any tropical matrix map.

As well as relating Wasserstein distances across spaces, Proposition 19 gives us the following corollary ensuring finite moments.

Corollary 21. For any ν ∈ P p (R n /R1) and any ∈ M tr , the push-forward ϕ * (ν) has finite pth moment; that is, ϕ * (ν) ∈ P p (R m /R1).

Proof. In order to prove that ϕ * (ν) has finite pth moment, we only need to show that there exists a measure with finite pth moment from which ϕ * (ν) has finite p-Wasserstein distance. Consider the Dirac measure on R m /R1, concentrated in 0. This can be seen as the push-forward of a Dirac measure in R n /R1 with the support in any point of x 0 ∈ F 0 . Let δ x be the Dirac measure concentrated at x. Then we can write

$W tr,p (δ 0 , ϕ * (ν)) = W tr,p (ϕ * (δ x0 ), ϕ * (ν)) ≤ W tr,p (δ x0 , ν) < ∞.$Here, notice the last term is finite since ν has finite moments by definition.

We now state and prove our main theorem: the equivalence of the tropical projection and embedding Wasserstein distances W - tr,p and W + tr,p . Theorem 22. Let p ∈ [1, ∞). For all µ ∈ P p (R m /R1) and ν ∈ P p (R n /R1), W - tr,p (µ, ν) = W + tr,p (µ, ν) < ∞.

Proof. The various results in Subsection 3.2 enable us to follow the same approach as in Theorem 2.2 of [Cai & Lim (2022)](#b6).

We begin by proving W - tr,p ≤ W + tr,p . By Proposition 19,

$W + tr,p (µ, ν) = inf ϕ∈Mtr {W tr,p (α, ν) : µ = ϕ * (α)} ≥ inf ϕ∈Mtr {W tr,p (µ, ϕ * (ν))} = W - tr,p (µ, ν).$Note that each W tr,p (µ, ϕ * (ν)) is finite by Corollary 21. Hence, W + tr,p (µ, ν) is finite. In order to show that W - tr,p (µ, ν) ≤ W + tr,p (µ, ν), we prove that for all ϵ > 0, and

$β ϵ ∈ Φ - tr,p (ν, m) such that W p (µ, β ϵ ) ≤ W - p (µ, ν) + ϵ, there exists α ϵ ∈ Φ + tr (µ, n) such that W tr,p (α ϵ , ν) ≤ W tr,p (µ, β ϵ )$. Indeed, if our claim is true, then we have ∀ ϵ > 0:

$W + tr,p (µ, ν) ≤ W tr,p (α ϵ , ν) ≤ W tr,p (µ, β ϵ ) ≤ W - p (µ, ν) + ϵ.$Letting ϵ tend to 0 gives us the desired result. Now let ϕ M be the simple projection sending ν to β ϵ , i.e., β ϵ = ϕ M (ν). Using the homeomorphism f M as defined in Proposition 18, we define the complementary projection to ϕ M as ϕ F0 M ; that is, ϕ F0 M = proj 2 • f M . We then construct α ϵ by defining a coupling on R n /R1 × R n /R1 with marginals ν, α ϵ . We first consider R m /R1 × F 0 × R m /R1 and look to apply the gluing lemma to f M (ν) and π m .

Lemma 23. [(Villani, 2009](#b36), Chapter 1) Let (X i , µ i ), i = 1, 2, 3 be Polish spaces. Let (X 1 , X 2 ) be a coupling of (µ 1 , µ 2 ) and (X 2 , X 3 ) be a coupling of (µ 2 , µ 3 ). Then there exists a coupling of random variables

$(Z 1 , Z 2 , Z 3 ) such that (Z 1 , Z 2 ) ∼ (X 1 , X 2 ) and (Z 2 , Z 3 ) ∼ (X 2 , X 3 ).$The space R m /R1 is Polish, while F 0 is a closed subset of a Polish space and is therefore also Polish. Hence, by the gluing lemma, there exist random vectors (X, Y, Z) on R m /R1 × F 0 × R m /R1 such that (X, Y ) ∼ f M (ν) and (X, Z) ∼ π m . We call the distribution of (X, Y, Z) ∼ π.

We now define ρ :

$R m /R1 × F 0 × R m /R1 → (R n /R1) 2 given by ρ(x, y, z) → (f -1 M (x, y), f -1 M (z, y)).$This is a measurable map as f -1 M is continuous. We then define a coupling π n on (R n /R1) 2 and measure α ϵ by π n = ρ(π) and α ϵ = proj 2 (π n ). It remains to show that π n is a coupling of ν, α ϵ , the distance W tr,p (α ϵ , ν) is bounded by W tr,p (µ, β ϵ ), and that α ϵ ∈ Φ + (µ, n).

Since α ϵ is the second marginal of π n by definition, it suffices to compute the first marginal:

$π n (A, R n /R1) = π(ρ -1 (A, R n /R1)) = π(f M (A), R m /R1) = ν(A).$We now want to bound W tr,p (α ϵ , ν) using π n . We begin by showing that for any (x, y) ∈ R m /R1 × F 0 and z ∈ R m /R1, we have d n tr (ρ(x, y, z)) = d m tr (x, z). We obtain the lower bound on d n tr (ρ(x, y, z)) through the following argument:

$d n tr (ρ(x, y, z)) = d n tr (f -1 M (x, y), f -1 M (z, y)) ≥ d m tr (ϕ M (f -1 M (x, y)), ϕ M (f -1 M (z, y))) = d m tr (x, z),$in which we used Proposition 9 for the inequality, while the equalities come from the definitions of ρ and f M , respectively. Using the upper bound of (9) gives the upper bound:

$d n tr (ρ(x, y, z)) = d n tr (f -1 M (x, y), f -1 M (z, y)) ≤ d m tr (x, z) + d n tr (ϕ F0 M (f -1 M (x, y)), ϕ F0 M (f -1 M (z, y))) = d m tr (x, z) + d n tr (y, y) = d m tr (x, z).$This gives us the following upper bound for W tr,p (α ϵ , ν):

$W tr,p (α ϵ , ν) p ≤ E U,V ∼πn [d n tr (U, V ) p ] = E X,Y,Z∼π [d n tr (ρ(X, Y, Z)) p ] = E X,Y,Z∼π [d m tr (X, Z) p ] = E X,Z∼πm [d m tr (X, Z) p ] = W tr,p (µ, β ϵ ) p .$
## Finally, it only remains to show that α

$ϵ ∈ Φ + (µ, n), i.e., ϕ M (α ϵ ) = µ: ϕ M (α ϵ )(A) = π n (R n /R1, ϕ -1 M (A)) = π(ρ -1 (R n /R1, ϕ -1 M (A))) = π(R m /R1, F 0 , A) = π m (R m /R1, A) = µ(A).$Given this equivalence, from now on, we now denote W - tr,p , W + tr,p by W m,n tr,p .

Remark 24. We stress that this proof only relies on ϕ ∈ M being a simple projection, and not M tr exhibiting any closure. We can therefore define Φ ± tr , W m,n tr,p with respect to any subset of maps M ′ tr ⊂ M tr and reach the same result.

However, it is important to note that the quantity W m,n tr,p (µ, ν) is not a formal metric. Indeed, we can have W m,n tr,p (µ, ν) = 0 for µ ̸ = ν if, say, ϕ ∈ M tr , such that ν = ϕ * (µ).

Proposition 25. The distance W m,n tr,p is 1-Lipschitz continuous on (P p (R m /R1), W tr,p )×(P p (R n /R1), W tr,p ).

Proof.

$|W m,n tr,p (µ 1 , ν 1 )-W m,n tr,p (µ 2 , ν 2 )| = inf ϕ∈Mtr W tr,p (µ 1 , ϕ * (ν 1 )) -inf ϕ∈Mtr W tr,p (µ 2 , ϕ * (ν 2 )) ≤| inf ϕ∈Mtr [W tr,p (µ 1 , µ 2 ) + W tr,p (µ 2 , ϕ * (ν 2 )) + W tr,p (ϕ * (ν 2 ), ϕ * (ν 1 ))] -inf ϕ∈Mtr W tr,p (µ 2 , ϕ * (ν 2 ))| ≤| inf ϕ∈Mtr [W tr,p (µ 1 , µ 2 ) + W tr,p (µ 2 , ϕ * (ν 2 )) + W tr,p (ϕ * (ν 2 ), ϕ * (ν 1 ))] -inf ϕ∈Mtr W tr,p (µ 2 , ϕ * (ν 2 ))| ≤|W tr,p (µ 1 , µ 2 ) + W tr,p (ϕ * (ν 2 ), ϕ * (ν 1 )) + inf ϕ∈Mtr [W tr,p (µ 2 , ϕ * (ν 2 ))] -inf ϕ∈Mtr W tr,p (µ 2 , ϕ * (ν 2 ))| ≤ |W tr,p (µ 1 , µ 2 ) + W tr,p (ν 2 , ν 1 )| ≤ W tr,p (µ 1 , µ 2 ) + W tr,p (ν 2 , ν 1 ).$This in turn gives the following implication for estimation of W m,n tr,p (µ, ν).

Corollary 26. Let X = {x 1 , . . . , x r } ⊂ R n /R1 and Y = {y 1 , . . . , y s } ⊂ R m /R1 sampled independently from µ ∈ P p (R m /R1) and ν ∈ P p (R n /R1), respectively. Consider μr and νs , the empirical measures of X and Y .Then W m,n tr,p = W m,n tr,p (μ r , νs ) is a consistent estimator for W m,n tr,p (µ, ν).

Proof. By Proposition 25 and the fact that Wasserstein distances respect weak convergence of measures (e.g., [Villani, 2009, Theorem 6](#).9), we only require the weak convergence of μr (/ν s ) to µ(/ν) as r(/s) tend to infinity. This is true by the law of large numbers as R n /R1 is a Polish space [(Monod et al., 2018)](#b26).

In this section we have defined simple projection matrices, the most general tropically linear maps through which we can project and embed measures while preserving non-expansivity and co-dimension. We have shown that the projection and embedding Wasserstein distances (defined with respect to simple projections) coincide as in the Euclidean case, despite the more complex geometry of the tropical projective torus. Furthermore, we have shown that this Wasserstein distance is Lipschitz, and so can be estimated consistently using samples from measures µ, ν.

## Open Problems and Implications: Phylogenetic Trees

To conclude this section, we return to the application of interest which motivated our work -tropical phylogenetic tree space. We have constructed projection and embedding Wasserstein distances between probability measures in tropical projective tori of different dimensions, and proved that the projection and embedding distances are equivalent. We would like to be able to use this tool to compare probability distributions over phylogenetic tree spaces -which are subspaces within tropical projective tori -where the numbers of leaves in the trees differ. There are, however, important theoretical considerations to take into account which are specific to phylogenetic trees.

The tropical space of phylogenetic trees with N leaves is characterised by those points in R N (N -1)/2 /R1 satisfying the four-point condition [(Buneman, 1974)](#b5).

Definition 27 (Four-Point Condition). Let d be a metric on N points. Then d corresponds to the graph distance on some tree with N leaves if and only if, ∀i, j, k, l ∈ [N ], the maximum of the following three terms is achieved twice:

$d(i, j) + d(k, l), d(i, k) + d(j, l), d(i, l) + d(j, k).$Definition 28 (Tropical Tree Space). The tropical tree space on N leaves, denoted by T N , is the set of vectors x ∈ R N (N -1)/2 /R1 such that {x ij } i̸ =j∈[N ] satisfies the four-point condition.

In light of these definitions, when calculating Wasserstein distances between measures which are supported on tropical tree space, it is natural to ask; which simple projections map tropical tree space into tropical tree space? Do such maps necessarily minimise the Wasserstein distance? The advantages of studying these simple projections are two-fold; we may be able to speed up computations by computing an infimum over a subset of simple projections rather than over all simple projections, and a theoretical understanding such maps may allow us to interpret the optimal simple projection as interpretable relations between the two leaf sets. Formally, we pose these questions in the following way:

Open Problem 29. Let MT tr be the set of simple projections M such that, for all x ∈ R N (N -1)/2 /R1 satisfying the four-point condition, M x ∈ R M (M -1)/2 /R1 satisfies the four-point condition. Can we find a parametric description of the set MT tr ? Open Problem 30. Suppose µ ∈ P p (T N ) and ν ∈ P p (T M ). Is it true that

$W m,n tr,p (µ, ν) := inf M ∈Mtr W tr,p (M µ, ν) = inf M ∈MTtr W tr,p (M µ, ν)?$A natural approach to Open Problem 29 may involve utilising the deep connections between tropical geometry and matroid theory [(Ardila & Klivans, 2006)](#b2), which is beyond the scope of this paper. An affirmative proof of Open Problem 30 would most likely require the parametrisation of MT tr from Open Problem 29, but it may be possible to directly construct a counter-example by exploiting the lack of tropical convexity of tropical tree space.

It may also be useful to first address simpler versions of Open Problems 29 and 30 by restricting to the case of ultrametric trees. These are special cases of phylogenetic trees which are equidistant; they are rooted phylogenetic trees where the distance from every leaf to its root is a constant. The set of such trees forms a tropical linear space, and hence is tropically convex [(Lin et al., 2017)](#b21). This convexity has been recently used to characterise the combinatorial behaviour of tree topologies in the tropical setting [(Lin et al., 2022)](#b22). The Open Problems 29 and 30 can also be posed with respect to ultrametric tree space rather than general tropical tree space, and may prove to be more tractable by utilising the tropical convexity of ultrametric space.

## Computation

Having defined tropical projection and embedding Wasserstein distances with sufficiently nice theoretical properties, in this section we demonstrate how existing optimisation techniques can be used for the computation of W m,n tr,p . The computation of W m,n tr,p is not a simple optimisation problem, as we require a minimal Wasserstein distance over the set of simple projections, which is a disconnected set. Lemma 31 shows that we can separate this problem into discrete and continuous parts by expressing W m,n tr,p as a minimisation problem over three components; the support of real entries in the simple projection matrix, the exact real entries of our matrix, and the joint weights λ r,s between the data points x r and y s . The proof of this lemma can be found in Appendix A.

Lemma 31. Let X = {x} r∈[R] and Y = {y} s∈[S] be finite datasets in R n /R1 and R m /R1 respectively. The Wasserstein distance W m,n tr,p (X, Y ) is the infimum of the function

$f (M, λ, t) = r,s λ r,s ∥M (x (r) + t) -y∥ p tr 1/p (14$$)$where t ∈ R N /R1, λ is a joint probability matrix with uniform marginals on [R] and [S], and M ∈ M ′ tr , where M ′ tr is the set of simple projections with all real entries equal to zero and exactly one real entry per column.

In this section we first outline the existing optimisation methods which can be used to optimise over M, λ, and t independently, before combining these methods to present our coordinate descent algorithm (Algorithm 1) for the computation of W m,n tr,p (X, Y ). We then apply this algorithm to simulated branching process data, coalescent data, and Gaussian data. To conclude, we compute the Wasserstein distances between phylogenetic influenza datasets across different annual seasons. The full results of numerical experiments are presented in Appendices B and C; the implementation for these experiments and the computations on simulated and real data are available in the GitHub repository at [https://github.com/Roroast/WDDD](https://github.com/Roroast/WDDD).

## Algorithm

We take a coordinate descent approach to the minimisation of the objective given in ( [14](#formula_86)), iteratively minimising a single component while fixing the others. To optimise the shift component t, we will consider gradient methods as f is piece-wise polynomial in terms of t. We will implement simulated annealing to solve the discrete optimisation problem of the optimal matrix support M , while optimising over λ is a classic discrete optimal transport problem, which is a linear program with efficient solvers [(Flamary et al., 2021)](#b12). In the following subsections we review various options for the gradient based optimisation of t and possible graph structures for simulated annealing in M , with full numerical experiments to compare the performances of various methods in Appendices B and C.

## Gradient Methods and Learning Rate

The objective function given in ( [14](#formula_86)) -for fixed M, λ -is piecewise polynomial in t with regions of sparse gradient. This raises what is known as the zig-zagging problem; when outside the tropical convex hull of the data, the sparse gradient of f can cause gradient methods to zig-zag across a "valley" of local minima. This behaviour is explored by [Talbut & Monod (2024)](#b33), where it is shown that tropical gradient methods can achieve smaller error on average and avoid convergence to local (non-global) minima.

In this paper we consider classical gradient descent (CD), tropical gradient descent (TD), Adamax (CA) and TrAdamax (TA) for the optimisation of t, and provide an outline of these methods below. For a detailed explanation and motivation for their implementation, see [Talbut & Monod (2024)](#b33).

Classical gradient descent(CD) follows the steepest descent algorithm with respect to the Euclidean norm. This is given by the following iterative rule:

$t k+1 = t k -α k d k , α k = αk -1/2 ∥∇f (t k )∥, d k = ∇f (t k ).(15)$Tropical gradient descent(TD) follows the steepest descent algorithm with respect to the tropical norm, which leads to the following iterative rule:

$t k+1 = t k -α k d k , α k = αk -1/2 ∥∇f (t k )∥ tr , d k = 1 ∇f (t k )>0 .(16)$Adamax(CA) is a variant of the Adam algorithm [(Kingma, 2014)](#b18), which uses exponentially weighted moments of the gradient to act as momentum terms. These momentum terms can independently adapt step sizes in each coordinate direction appropriately. While Adam uses L 2 moments of the gradient, Adamax uses L ∞ moments and is shown to behave better than Adam in tropical optimisation problems [(Talbut & Monod, 2024)](#b33).

TrAdamax(TA) is a heuristic adaptation of the Adamax algorithm, which uses exponentially weighted moments of the tropical descent directions 1 ∇f (t k )>0 , rather than the gradient ∇f (t k ).

Using data of varying dimensionality and distribution, we implemented CA, CD, TA and TD for the minimisation of the loss function f with respect to t. We present the full methodology and results in Appendix B, while Table [1](#tab_0) presents the mean loss over all data types. We see that TA (with learning rate α = e -1 ) achieves the best mean loss. The optimal TA learning rates for each data dimension pair is presented in Table [2](#) Table 2:

The TA learning rate α achieving the minimal mean loss f over 10 initialisations and 9 sample distributions for each dimension pairs m ≤ n ∈ {6, 10, 15}.

## Simulated Annealing Graph and Scale

The most intensive challenge in minimising the objective ( [14](#formula_86)) is the combinatorial problem of identifying the optimal support of our matrix map. As shown in Lemma 31, it suffices to consider matrices with exactly one real entry in each column as we are computing on finite datasets. We can identify this set of supports with the set of surjections [n] → [m], so the size of this set is given explicitly by m!S(n, m), where S(n, m) is the Stirling number of the second kind. Table [3](#) shows these values for m ≤ n ≤ 6.

n m 1 2 3 4 5 6 1 1 2 1 2 3 1 6 6 4 1 14 36 24 5 1 30 150 240 120 6 1 62 540 1560 1800 720

Table [3](#): The number of possible matrix supports of n × m simple projections.

Due to the exponential growth of the number of supports, we implement simulated annealing [(Kirkpatrick et al., 1983)](#b19) rather than an exhaustive search to find the optimal support. Simulated annealing is a Metropolis procedure on the set of supports, where we perform a random walk and accept any step which decreases f , while accepting increasing steps with probability exp(-∆f /T (k)), where T is linearly decreasing in the step number k.

To implement simulated annealing, we require a graph structure on our set of possible supports G = (M ′ tr , E); we shall consider E to contain exactly those edges between two supports M 1 , M 2 whose matrices differ in exactly one column or are the same up to column permutations. For any dimensions n, m, this results in a connected graph of supports. As a benchmark, we compare the computational performance of this graph G with a complete graph K. We also optimise over the scale factor σ of the linearly decreasing T (k). The full methodology and results are in Appendix C, while Table [4](#tab_2) summarises the mean loss of simulated annealing with respect to the graph structure. The incomplete graph G outperforms the complete graph K, achieving minimal mean loss with a scale of e -2 .

## Coordinate Descent Algorithm

Informed by the numerical experiments presented in Appendices B and C, our complete algorithm for the minimisation of the objective ( [14](#formula_86)) is given by Algorithm 1, with the default hyper-parameters given by the Table 5: The simulated annealing scale σ achieving the minimal mean loss f over 10 initialisations and 9 sample distributions for each dimension pairs m ≤ n ∈ {6, 10, 15}.

optimal learning rate α and scale σ shown in Tables [2](#) and [5](#). To solve the optimal transport linear program for the optimal λ, we use the POT Python package [(Flamary et al., 2021)](#b12).

## Simulated Data

To visualise the results of Algorithm 1 and compare distances between distributions of different types, we consider simulated datasets of sample size 50 taken from branching tree and coalescent tree distributions on T 4 ⊂ R 6 /R1, T 5 ⊂ R 10 /R1, T 6 ⊂ R 15 /R1, as well as standard Gaussian distributions on R 6 , R 10 , R 15 . These distributions are all coordinate invariant, and so symmetric about the origin of the tropical projective torus. We therefore normalise these datasets by the average tropical norm of their data points to remove effects of the dimensionality on the scale of the data.

We then run Algorithm 1 for k max = 40 steps, and run simulated annealing and TrAdamax for i max , j max = 50 sub-steps for each k to compute the Wasserstein distances between branching process, coalescent, and Gaussian data in R 6 /R1, R 10 /R1, R 15 /R1. For each dataset pair, we run Algorithm 1 from 10 random initialisations and take the minimal value over all initialisations. Figure [5](#) shows the Wasserstein distances between these datasets as a matrix heatmap. We note from Figure [5](#) that the datasets from coalescent processes have a greater Wasserstein distance to other datasets, even to other coalescent datasets.

## Computation for Influenza Data

To conclude the computational section of this paper, we use Algorithm 1 to compute Wasserstein distances between real phylogenetic datasets which are supported on different datasets.

We use the pre-processed phylogenetic influenza datasets presented by [Monod et al. (2018)](#b26); this phylogenetic data is computed from the genetic sequences of the influenza A H3N2 hemagglutinin obtained for New York, 1993-2017, from the GISAID EpiFlu™database [(Elbe & Buckland-Merrett, 2017)](#b11). The raw genomic data was then aligned using MUSCLE [(Edgar, 2004)](#b10) with default settings, to construct a single large phylogenetic tree for the influenza strains across all seasons. Finally, tree dimensionality reduction [(Zairis et al., 2016)](#b39) is applied to represent this large phylogenetic tree as a dataset of smaller trees using temporal windows of 5 years; this produces 21 datasets of approximately 20,000 trees each, where the leaf set of a given dataset corresponds to 5 consecutive years. For further details on data pre-processing, see [Monod et al. (2018)](#b26).

From each dataset, we sub-sample 50 tree data points to reduce the computational load on the optimal transport calculations. We use the R package APE [(Paradis et al., 2004)](#b29) to compute the pairwise leaf distances from the Newick tree format for each tree, to produce 21 datasets of 50 data points of dimension 10. We note that though the dimensionality of each dataset is the same, the dimensions for each dataset correspond to different pairs of years; there is therefore no natural correspondence between the dimensions of the 1993-1997 dataset and the 2013-2017 dataset.

Figure [5](#): The computed Wasserstein distance between branching, coalescent and Gaussian data of dimension 6, 10 and 15. We take a minimum over 10 initialisations of Algorithm 1, and use the tuned learning rate and scale from Tables [1](#tab_0) and [4](#tab_2).

Figure [6](#) shows the computed Wasserstein distances between the 21 datasets. From Figure [6](#), we observe that all datasets for temporal windows containing 2002 have relatively small distances to each other, while having larger distances to all other seasons. We note that this time window has significant overlap with the prominence of the A/Fujian/411/2002 virus strain, which led to an ineffective trivalent inactivated influenza vaccine in 2003 (Centers for Disease Control and Prevention (CDC) and others, 2004). We also observe a small computed Wasserstein distance between the datasets of [1996-2000 and 2003-2007](#), which may reflect the mutation reassortment events which are discussed by [Holmes et al. (2005)](#b15).

## Discussion

In this manuscript, we have studied the problem of comparing probability distributions over tropical projective tori with different dimensions and formulated an inter-dimensional Wasserstein distance for this purpose. Our construction was largely inspired by a recent solution to the same problem in Euclidean spaces. We highlighted the key components of semi-orthogonal maps used in the Euclidean setting and identified tropical matrices with the same properties to be able to arrive at the same conclusion on tropical projective tori. Specifically, we studied tropical simple projections; only the basic properties of non-expansivity, surjectivity, and fibres of consistent dimension were required in order to achieve the same result as in the Euclidean setting, even though the tropical projective torus can be seen as comparatively more restrictive (e.g., it is not a Hilbert space under the tropical norm [(Améndola & Monod, 2024)](#b1)).

Considering our motivating application of phylogenetic statistics, it would be natural to build on this work by a consideration of how simple projections act on tree space; which simple projections map tree space to tree space? Does it suffice to consider such maps when finding the optimal map between tree datasets? Can a simple projection which maps tree space to tree space be described by operations on leaves? These questions, which we discussed in more detail in Subsection 4.2 present the opportunity to improve the speed of calculations through a restricted search of simple projections, as well as gaining more interpretability from Figure [6](#): The computed Wasserstein distance between branching, coalescent and Gaussian data of dimension 6, 10 and 15. We take a minimum over 10 initialisations of Algorithm 1, and use the tuned learning rate and scale from Tables [1](#tab_0) and [4](#tab_2). our calculations on the leaf level.

While our computational method in Algorithm 1 is a natural heuristic approach and easy to implement, further research into more sophisticated optimisation tools for calculating tropical projection Wasserstein distances would significantly improve the applicability of our distance. Currently, we lack confidence bounds on our computations in Section 5, and we can see immediately that our computations are not necessarily accurate; in Figure [5](#), we see datasets whose distance to themselves is not zero. This may be a result of simulated annealing never reaching the optimal support as it is more common for datasets of higher dimension, but without confidence bounds our distances lack interpretability.

Finally, while tropical projection Wasserstein distances may be a useful tool for certain statistical methods such as clustering, utilising these distances for more refined model selection methods would require an understanding of their behaviour for standard tree models such as branching and coalescent processes. The computed values shown in Figure [5](#) do not suggest a clear pattern in the distances between datasets of the same distribution but different dimensionality, but there are many avenues for further numerical experiments. By computing distances between several samples from the same distribution, we may see some indication as to which distributions are well-clustered under the tropical projection Wasserstein distance and hence can be detected for model selection using this distance.

Academy of Doctoral Studies (JADS) award (2021 cohort, PIs Drton/Monod), from which R.T. also receives partial support.

## Appendix A Proof

Proof of Lemma 31. Consider a simple projection matrix M , and let M ′ be a tropical matrix map with exactly one real entry per column such that M ij ∈ R ⇒ M ′ ij = 0. We begin by showing that on any ball B 0 (r) in R n /R1, there is some t ∈ R n /R1 such that M (x) = M ′ (x + t).

For each j ∈ ∪ i J i , let i j be the unique i such that j ∈ J i . Then we can define a vector t ∈ R n by

$t j = -2r + min{M ij : M ij ̸ = -∞} if j / ∈ ∪ i J i M ij j$otherwise.

We now show that for x ∈ B 0 (r), we have M x = M ′ (x + t). Let J ′ i be the support sets for M ′ . By definition, the sets J ′ i are disjoint, partition [n] exactly, and

$J i ⊆ J ′ i . M ′ (x + t) = max j∈J ′ i {M ′ ij + x j + t j } = max{max j∈Ji {x j + M ij }, max j∈J ′ i \Ji x j + -2r + min{M ij : M ij ̸ = -∞}} = max j∈Ji {x j + M ij } = M (x)$where the penultimate equality comes from ∥x∥ tr ≤ r. Now, denoting the empirical measure of X as ν X , our set of projected measures becomes: where the constraints on t, M ′ and λ are as described.

## Appendix B Gradient Methods

These experiments are aimed at the computation of the 2-Wasserstein projected distance W m,n tr,2 , and are restricted to samples X, Y of equal sizes R = S to reduce the computational complexity of optimal transport calculations.

We test the gradient methods CD, TD, CA, TA in the following way; for each dimension pair m ≤ n ∈ {6, 10, 15}, we have 9 dataset pairs (X, Y ) where X, Y have been taken from a branching, coalescent or Gaussian distribution. We then run Algorithm 1 with 10 random initialisations for max iters = 40. Each iteration of Algorithm 1 involves 50 steps of the specified gradient method -we do not perform any λ, M optimisation to minimise the random noise present. We do this for each dataset and gradient method for learning rates on a log scale between e -6 , e 4 . Table [6](#tab_4) shows the mean loss achieved over 10 randomised initialisations and all 9 dataset pairs for each dimension pair and gradient settings.

We see that when n = m, classical and tropical methods behave similarly; their optimal mean loss is the same, though this minimum is achieved for different learning rates. However, when m < n the tropical methods consistently achieve a smaller mean loss.  [.196 1.196 1.196 1.196 1.196 1.194 1.195](#)

![Figure 1: The tropical ball under φ : R 3 /R1 → R 2]()

![Figure 3: R 3 /R1 ∼ = R 2 partitioned by type with respect to M := a b c d e f .]()

![Figure 4: R 3 /R1 ∼ = R 2 partitioned by type with respect to M in Example 12.]()

![- tr and Φ + tr are now given by Φ - tr (ν, m) := {β ∈ P (R m /R1) : β = ϕ * (ν) for some ϕ ∈ M tr }, Φ + tr (µ, n) := {α ∈ P (R n /R1) : µ = ϕ * (α) for some ϕ ∈ M tr }, while the tropical projection and embedding Wasserstein distances are given by]()

![(x (r) +t) : t ∈ R n] /R1, M ′ ∈ M ′ express the Wasserstein distance W m,n tr,p by W m,n tr,p (µ, ν) = inf t,M ′ inf λ r,s λ r,s d tr (M ′ (x (r) + t), y) p s ∥M ′ (x (r) + t) -y∥ p tr]()

![]()

![]()

![.The mean loss f over 10 initialisations, 9 sample distributions and 6 dimension pairs m ≤ n ∈ {6, 10, 15} achieved by classical Adam, classical descent, TrAdamax, and tropical descent. Learning rate is varied on a linear log scale from e -5 , e 4 .]()

![The mean loss over 10 initialisations, 9 sample distributions and 6 dimension pairs m ≤ n ∈ {6, 10, 15} achieved by simulated annealing on the G and K graph structures. Scale is varied on a linear log scale from e -7 , e 2 .]()

![Table 6 also shows the mean loss averaged over all dimension pairs; the globally optimum gradient settings are TA, α = 0.3679. The mean loss over 10 initialisations and 9 sample distributions achieved by classical Adam, classical descent, TrAdamax, and tropical descent for data of dimensionality m ≤ n ∈ {6, 10, 15}. Learning rate is varied on a linear log scale from e -6]()

![The mean loss over 10 initialisations and 9 sample distributions achieved by simulated annealing on the incomplete and complete graph structures for data of dimensionality m ≤ n ∈ {6, 10, 15}. The scale factor is varied on a linear log scale from e -7]()

